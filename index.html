<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LensLink - Online Photography Booking</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }
        .font-serif-display {
            font-family: 'Playfair Display', serif;
        }
        .nav-link {
            transition: color 0.3s;
        }
        .nav-link:hover {
            color: #fb923c; /* orange-400 */
        }
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
        .hero-bg {
            background-image: url('https://images.unsplash.com/photo-1516035069371-29a1b244cc32?q=80&w=2864&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
        }
        .flatpickr-day.selected {
            background: #fb923c;
            border-color: #fb923c;
        }
        .flatpickr-day.today {
            border-color: #fb923c;
        }
        .flatpickr-day.disabled {
            color: #94a3b8; /* slate-400 */
        }
    </style>
</head>
<body class="text-slate-800">

    <!-- Header -->
    <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#" class="text-2xl font-bold text-slate-900 font-serif-display" data-page="home">LensLink</a>
            <div class="hidden md:flex items-center space-x-8">
                <a href="#" class="nav-link" data-page="home">Home</a>
                <a href="#" class="nav-link" data-page="about">About</a>
                <a href="#" class="nav-link" data-page="contact">Contact</a>
            </div>
            <div class="hidden md:flex items-center space-x-4">
                <div id="auth-buttons" class="flex items-center space-x-4">
                    <a href="#" class="px-4 py-2 text-sm font-medium rounded-md hover:bg-slate-100" data-page="login">Log In</a>
                    <a href="#" class="px-4 py-2 text-sm font-medium text-white bg-slate-800 rounded-md hover:bg-slate-700" data-page="login">Register</a>
                </div>
                <div id="user-menu" class="hidden flex items-center space-x-4">
                    <span id="user-welcome" class="text-sm text-slate-600"></span>
                    <div class="relative">
                        <button id="user-menu-button" class="flex items-center space-x-2 px-4 py-2 text-sm font-medium rounded-md hover:bg-slate-100">
                            <img id="user-avatar" src="" alt="User Avatar" class="w-8 h-8 rounded-full">
                            <span id="user-name"></span>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div id="user-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50">
                            <a href="#" id="find-photographers-link" class="hidden block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100">Find Photographers</a>
                            <a href="#" id="my-bookings" class="block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100">My Bookings</a>
                            <a href="#" id="my-profile" class="block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100">Profile</a>
                            <div id="photographer-menu" class="hidden">
                                <a href="#" id="my-recent-bookings" class="block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100">My Recent Bookings</a>
                            </div>
                            <hr class="my-1">
                            <a href="#" id="logout-btn" class="block px-4 py-2 text-sm text-slate-700 hover:bg-slate-100">Logout</a>
                        </div>
                    </div>
                </div>
            </div>
            <button id="mobile-menu-button" class="md:hidden">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
            </button>
        </nav>
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden md:hidden px-6 pb-4 space-y-2">
            <a href="#" class="block nav-link" data-page="home">Home</a>
            <a href="#" class="block nav-link" data-page="about">About</a>
            <a href="#" class="block nav-link" data-page="contact">Contact</a>
            <div class="border-t border-slate-200 pt-4 space-y-2">
                 <a href="#" class="block text-center px-4 py-2 text-sm font-medium rounded-md hover:bg-slate-100" data-page="login">Log In</a>
                <a href="#" class="block text-center px-4 py-2 text-sm font-medium text-white bg-slate-800 rounded-md hover:bg-slate-700" data-page="login">Register</a>
            </div>
        </div>
    </header>

    <main>
        <!-- Home Page -->
        <div id="home" class="page active">
            <!-- Hero Section -->
            <section class="hero-bg text-white min-h-[60vh] flex items-center">
                <div class="container mx-auto px-6 text-center bg-black/50 py-20 rounded-lg">
                    <h1 class="text-4xl md:text-6xl font-bold font-serif-display mb-4">Capture Your Moments, Effortlessly</h1>
                    <p class="text-lg md:text-xl mb-8 max-w-3xl mx-auto">Connect with professional photographers and showcase your photography skills. Join our community of talented artists.</p>
                    <a href="#" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-8 rounded-full text-lg transition duration-300" data-page="login">Join LensLink Community</a>
                </div>
            </section>

            <!-- Features Section -->
            <section class="py-16 bg-white">
                <div class="container mx-auto px-6">
                    <div class="text-center mb-12">
                        <h2 class="text-3xl font-bold font-serif-display">Why Choose LensLink?</h2>
                        <p class="text-slate-600 mt-2">A seamless experience for clients and photographers alike.</p>
                    </div>
                    <div class="grid md:grid-cols-3 gap-8 text-center">
                        <div class="p-6">
                            <div class="flex items-center justify-center h-16 w-16 rounded-full bg-orange-100 text-orange-500 mx-auto mb-4">
                                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                            </div>
                            <h3 class="text-xl font-semibold mb-2">Instant Booking</h3>
                            <p class="text-slate-600">Book your preferred photographer anytime, anywhere. Check real-time availability and get instant confirmation.</p>
                        </div>
                        <div class="p-6">
                            <div class="flex items-center justify-center h-16 w-16 rounded-full bg-orange-100 text-orange-500 mx-auto mb-4">
                                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                            </div>
                            <h3 class="text-xl font-semibold mb-2">Discover Talent</h3>
                            <p class="text-slate-600">Explore portfolios of talented photographers. Search by specialty, location, or name to find the perfect match for your needs.</p>
                        </div>
                        <div class="p-6">
                            <div class="flex items-center justify-center h-16 w-16 rounded-full bg-orange-100 text-orange-500 mx-auto mb-4">
                                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            </div>
                            <h3 class="text-xl font-semibold mb-2">Secure & Simple</h3>
                            <p class="text-slate-600">All your booking details are managed in one place. Secure payments and clear communication from start to finish.</p>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- About Page -->
        <div id="about" class="page container mx-auto px-6 py-16">
            <div class="text-center mb-12">
                <h1 class="text-4xl font-bold font-serif-display">Modernizing Photography Bookings</h1>
                <p class="text-lg text-slate-600 mt-2">Replacing inefficient manual methods with a streamlined online system.</p>
            </div>
            
            <div class="bg-white p-8 rounded-lg shadow-md">
                <h2 class="text-2xl font-bold mb-4">Project Introduction</h2>
                <p class="text-slate-700 leading-relaxed">The "Online Photography Booking" project aims to modernize and improve the photography profession by creating a centralized digital platform. The primary goal is to simplify the entire procedure, making it significantly easier for clients to schedule a booking and for photographers to manage their work. This project will be useful and helpful by making professional photography services more accessible to everyone.</p>
            </div>

            <div class="grid md:grid-cols-2 gap-8 mt-12">
                <div class="bg-red-50 border border-red-200 p-8 rounded-lg">
                    <h3 class="text-2xl font-bold text-red-800 mb-4">The Existing System: Disadvantages</h3>
                    <ul class="space-y-3 text-red-700 list-disc list-inside">
                        <li>Difficult to track the real-time availability of photographers.</li>
                        <li>Managing bookings from multiple customers is inefficient and prone to error.</li>
                        <li>Process is inconvenient for clients, who cannot book outside of business hours.</li>
                        <li>Relies on phone calls and in-person visits, which is time-consuming.</li>
                    </ul>
                </div>
                <div class="bg-green-50 border border-green-200 p-8 rounded-lg">
                    <h3 class="text-2xl font-bold text-green-800 mb-4">The Proposed System: Advantages</h3>
                    <ul class="space-y-3 text-green-700 list-disc list-inside">
                        <li>Users can book a photographer anytime and from anywhere.</li>
                        <li>Instantly check the availability of photographers on a clear timetable.</li>
                        <li>All booking information is managed centrally and securely.</li>
                        <li>Safe, easy to retrieve data, and convenient for everyone involved.</li>
                    </ul>
                </div>
            </div>
            
            <div class="bg-white p-8 rounded-lg shadow-md mt-12">
                <h2 class="text-2xl font-bold mb-4">Technology Stack</h2>
                <p class="text-slate-700 mb-4">LensLink is built using modern web technologies to provide a fast, responsive, and user-friendly experience. This standalone web application runs entirely in the browser with no server dependencies.</p>
                <div class="grid md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-lg font-semibold mb-3 text-orange-600">Frontend Technologies</h3>
                        <div class="flex flex-wrap gap-2">
                            <span class="bg-orange-100 text-orange-800 text-sm font-medium px-3 py-1 rounded-full">HTML5</span>
                            <span class="bg-blue-100 text-blue-800 text-sm font-medium px-3 py-1 rounded-full">CSS3</span>
                            <span class="bg-cyan-100 text-cyan-800 text-sm font-medium px-3 py-1 rounded-full">Tailwind CSS</span>
                            <span class="bg-yellow-100 text-yellow-800 text-sm font-medium px-3 py-1 rounded-full">JavaScript (ES6+)</span>
                            <span class="bg-purple-100 text-purple-800 text-sm font-medium px-3 py-1 rounded-full">Responsive Design</span>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold mb-3 text-green-600">Architecture & Features</h3>
                        <div class="flex flex-wrap gap-2">
                            <span class="bg-green-100 text-green-800 text-sm font-medium px-3 py-1 rounded-full">Single Page Application</span>
                            <span class="bg-indigo-100 text-indigo-800 text-sm font-medium px-3 py-1 rounded-full">LocalStorage Database</span>
                            <span class="bg-pink-100 text-pink-800 text-sm font-medium px-3 py-1 rounded-full">Client-Side Routing</span>
                            <span class="bg-slate-100 text-slate-800 text-sm font-medium px-3 py-1 rounded-full">Progressive Web App</span>
                        </div>
                    </div>
                </div>
                <div class="mt-6 grid md:grid-cols-3 gap-4">
                    <div class="bg-slate-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-slate-800 mb-2">🎨 UI Framework</h4>
                        <p class="text-sm text-slate-600">Tailwind CSS for modern, responsive styling with custom color schemes and animations</p>
                    </div>
                    <div class="bg-slate-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-slate-800 mb-2">💾 Data Storage</h4>
                        <p class="text-sm text-slate-600">Browser LocalStorage for persistent user data, bookings, and photographer profiles</p>
                    </div>
                    <div class="bg-slate-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-slate-800 mb-2">🔧 Development</h4>
                        <p class="text-sm text-slate-600">Vanilla JavaScript with ES6+ features, modular architecture, and cross-browser compatibility</p>
                    </div>
                </div>
                <div class="mt-6 p-4 bg-orange-50 border border-orange-200 rounded-lg">
                    <h4 class="font-semibold text-orange-800 mb-2">🚀 Key Advantages</h4>
                    <ul class="text-sm text-orange-700 space-y-1">
                        <li>• <strong>No Server Required:</strong> Runs entirely in the browser</li>
                        <li>• <strong>Fast Performance:</strong> Instant loading with no API calls</li>
                        <li>• <strong>Offline Capable:</strong> Works without internet connection</li>
                        <li>• <strong>Mobile Responsive:</strong> Optimized for all device sizes</li>
                        <li>• <strong>Easy Deployment:</strong> Can be hosted on any web server or CDN</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Find Your Photographers Page (For logged-in clients) -->
        <div id="find-photographers" class="page container mx-auto px-6 py-16">
            <div class="text-center mb-12">
                <h1 class="text-4xl font-bold font-serif-display">Find Your Photographers</h1>
                <p class="text-lg text-slate-600 mt-2">Browse our talented photographers and book your perfect session.</p>
            </div>

            <!-- Search Bar -->
            <div class="mb-8 bg-white p-4 rounded-lg shadow-sm flex flex-col md:flex-row gap-4">
                <input type="text" id="photographer-search" placeholder="Search by name, e.g., 'Jane Doe'" class="flex-grow p-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-orange-400 focus:border-transparent">
                <select id="specialty-filter" class="p-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-orange-400 focus:border-transparent">
                    <option value="">All Specialties</option>
                    <option value="weddings">Weddings</option>
                    <option value="portraits">Portraits</option>
                    <option value="events">Events</option>
                    <option value="commercial">Commercial</option>
                    <option value="fashion">Fashion</option>
                    <option value="nature">Nature</option>
                    <option value="street">Street Photography</option>
                    <option value="sports">Sports</option>
                    <option value="other">Other</option>
                </select>
                <button onclick="searchRegisteredPhotographers()" class="bg-slate-800 text-white font-bold py-3 px-6 rounded-md hover:bg-slate-700">Search</button>
            </div>

            <!-- Photographer Grid -->
            <div id="registered-photographers-grid" class="grid sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
                <!-- Dynamic photographer cards will be loaded here -->
                <div class="text-center py-8 col-span-full">
                    <p class="text-slate-500">Loading photographers...</p>
                </div>
            </div>
        </div>

        <!-- Find a Photographer Page -->
        <div id="photographers" class="page container mx-auto px-6 py-16">
            <div class="text-center mb-12">
                <h1 class="text-4xl font-bold font-serif-display">Find Your Photographer</h1>
                <p class="text-lg text-slate-600 mt-2">Search for the perfect artist to capture your special moments.</p>
            </div>

            <!-- Search Bar -->
            <div class="mb-8 bg-white p-4 rounded-lg shadow-sm flex flex-col md:flex-row gap-4">
                <input type="text" placeholder="Search by name, e.g., 'Jane Doe'" class="flex-grow p-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-orange-400 focus:border-transparent">
                <select class="p-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-orange-400 focus:border-transparent">
                    <option>All Specialties</option>
                    <option>Weddings</option>
                    <option>Portraits</option>
                    <option>Events</option>
                    <option>Commercial</option>
                </select>
                <button class="bg-slate-800 text-white font-bold py-3 px-6 rounded-md hover:bg-slate-700">Search</button>
            </div>

            <!-- Photographer Grid -->
            <div class="grid sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
                <!-- Photographers will be loaded dynamically by JavaScript -->
                <div class="col-span-full text-center py-8">
                    <p class="text-slate-500">Loading photographers...</p>
                </div>
            </div>
        </div>
        
        <!-- Photographer Profile Page -->
        <div id="profile" class="page container mx-auto px-6 py-16">
            <!-- Dynamic profile content will be loaded here by JavaScript -->
            <div class="text-center py-16">
                <p class="text-slate-500">Loading photographer profile...</p>
            </div>
        </div>

        <!-- User Profile Page -->
        <div id="user-profile" class="page container mx-auto px-6 py-16">
            <div class="max-w-4xl mx-auto">
                <div class="bg-white p-8 rounded-lg shadow-lg">
                    <div class="text-center mb-8">
                        <h1 class="text-3xl font-bold font-serif-display">My Profile</h1>
                        <p class="text-slate-600 mt-2">Manage your account information</p>
                    </div>
                    
                    <div id="user-profile-content" class="grid md:grid-cols-2 gap-8">
                        <!-- Profile content will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Contact Page -->
        <div id="contact" class="page container mx-auto px-6 py-16">
            <div class="text-center mb-12">
                <h1 class="text-4xl font-bold font-serif-display">Get In Touch</h1>
                <p class="text-lg text-slate-600 mt-2">Have questions? We'd love to hear from you.</p>
            </div>
            <div class="max-w-2xl mx-auto bg-white p-8 rounded-lg shadow-md">
                <form action="#" method="POST" class="space-y-6">
                    <div>
                        <label for="name" class="block text-sm font-medium text-slate-700">Full Name</label>
                        <input type="text" name="name" id="name" class="mt-1 block w-full p-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-orange-400 focus:border-transparent">
                    </div>
                    <div>
                        <label for="email" class="block text-sm font-medium text-slate-700">Email Address</label>
                        <input type="email" name="email" id="email" class="mt-1 block w-full p-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-orange-400 focus:border-transparent">
                    </div>
                    <div>
                        <label for="message" class="block text-sm font-medium text-slate-700">Message</label>
                        <textarea name="message" id="message" rows="4" class="mt-1 block w-full p-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-orange-400 focus:border-transparent"></textarea>
                    </div>
                    <div>
                        <button type="submit" class="w-full bg-slate-800 text-white font-bold py-3 px-6 rounded-md hover:bg-slate-700 transition-colors">Send Message</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Login/Register Page -->
        <div id="login" class="page container mx-auto px-6 py-16">
            <div class="max-w-md mx-auto">
                <div class="bg-white p-8 rounded-xl shadow-lg">
                    <div class="flex justify-center mb-6">
                        <button id="login-tab" class="px-6 py-2 font-semibold text-lg border-b-2 border-orange-500 text-orange-500">Log In</button>
                        <button id="register-tab" class="px-6 py-2 font-semibold text-lg text-slate-500">Register</button>
                    </div>

                    <!-- Login Form -->
                    <form id="login-form" class="space-y-6">
                        <h2 class="text-2xl font-bold text-center">Welcome Back!</h2>
                        <div>
                            <label for="login-email" class="block text-sm font-medium text-slate-700">Email</label>
                            <input type="email" id="login-email" required class="mt-1 block w-full p-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-orange-400 focus:border-transparent">
                        </div>
                        <div>
                            <label for="login-password" class="block text-sm font-medium text-slate-700">Password</label>
                            <input type="password" id="login-password" required class="mt-1 block w-full p-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-orange-400 focus:border-transparent">
                        </div>
                        <button type="submit" onclick="if(window.handleLoginBackup) { window.handleLoginBackup(event); return false; }" class="w-full bg-orange-500 text-white font-bold py-3 rounded-md hover:bg-orange-600">Log In</button>
                        <div id="login-error" class="hidden text-red-600 text-sm text-center"></div>
                        <div id="login-success" class="hidden text-green-600 text-sm text-center"></div>
                    </form>

                    <!-- Register Form -->
                    <form id="register-form" class="hidden space-y-6">
                        <h2 class="text-2xl font-bold text-center">Create Your Account</h2>
                        
                        <!-- Basic Information -->
                        <div id="basic-info">
                            <div>
                                <label for="register-name" class="block text-sm font-medium text-slate-700">Full Name</label>
                                <input type="text" id="register-name" required class="mt-1 block w-full p-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-orange-400 focus:border-transparent">
                            </div>
                            <div class="mt-4">
                                <label for="register-email" class="block text-sm font-medium text-slate-700">Email</label>
                                <input type="email" id="register-email" required class="mt-1 block w-full p-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-orange-400 focus:border-transparent">
                            </div>
                            <div class="mt-4">
                                <label for="register-password" class="block text-sm font-medium text-slate-700">Password</label>
                                <input type="password" id="register-password" required minlength="6" class="mt-1 block w-full p-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-orange-400 focus:border-transparent">
                            </div>
                            <div class="mt-4">
                                <label for="register-role" class="block text-sm font-medium text-slate-700">Account Type</label>
                                <select id="register-role" class="mt-1 block w-full p-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-orange-400 focus:border-transparent">
                                    <option value="client">Client (Book Photographers)</option>
                                    <option value="photographer">Photographer (Offer Services)</option>
                                </select>
                            </div>
                            <div class="mt-4">
                                <label for="register-phone" class="block text-sm font-medium text-slate-700">Phone Number (Optional)</label>
                                <input type="tel" id="register-phone" class="mt-1 block w-full p-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-orange-400 focus:border-transparent">
                            </div>
                        </div>

                        <!-- Photographer Additional Info (Hidden by default) -->
                        <div id="photographer-info" class="hidden space-y-4 border-t pt-4">
                            <h3 class="text-lg font-semibold text-slate-800">Photographer Profile</h3>
                            <div>
                                <label for="register-profile-photo" class="block text-sm font-medium text-slate-700">Profile Photo</label>
                                <input type="file" id="register-profile-photo" accept="image/*" 
                                       onchange="previewProfileImage(this)"
                                       class="mt-1 block w-full p-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-orange-400 focus:border-transparent">
                                <p class="text-xs text-slate-500 mt-1">Upload a professional profile photo (JPG, PNG, WebP, max 10MB - will be optimized automatically)</p>
                                
                                <!-- Image Preview Container -->
                                <div id="profile-image-preview" class="mt-3"></div>
                            </div>
                            <div>
                                <label for="register-bio" class="block text-sm font-medium text-slate-700">Bio (Describe your photography style)</label>
                                <textarea id="register-bio" rows="3" placeholder="Tell clients about your photography style and experience..." class="mt-1 block w-full p-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-orange-400 focus:border-transparent"></textarea>
                            </div>
                            <div>
                                <label for="register-specialties" class="block text-sm font-medium text-slate-700">Specialties</label>
                                <select id="register-specialties" multiple class="mt-1 block w-full p-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-orange-400 focus:border-transparent" style="height: 120px;">
                                    <option value="weddings">Weddings</option>
                                    <option value="portraits">Portraits</option>
                                    <option value="events">Events</option>
                                    <option value="commercial">Commercial</option>
                                    <option value="fashion">Fashion</option>
                                    <option value="nature">Nature</option>
                                    <option value="street">Street Photography</option>
                                    <option value="sports">Sports</option>
                                    <option value="other">Other</option>
                                </select>
                                <p class="text-xs text-slate-500 mt-1">Hold Ctrl/Cmd to select multiple specialties</p>
                            </div>
                            <div>
                                <label for="register-hourly-rate" class="block text-sm font-medium text-slate-700">Hourly Rate ($)</label>
                                <input type="number" id="register-hourly-rate" min="0" placeholder="150" class="mt-1 block w-full p-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-orange-400 focus:border-transparent">
                            </div>
                            <div>
                                <label for="register-experience" class="block text-sm font-medium text-slate-700">Years of Experience</label>
                                <input type="number" id="register-experience" min="0" max="50" placeholder="5" class="mt-1 block w-full p-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-orange-400 focus:border-transparent">
                            </div>
                            <div>
                                <label for="register-location" class="block text-sm font-medium text-slate-700">Location (City, State)</label>
                                <input type="text" id="register-location" placeholder="New York, NY" class="mt-1 block w-full p-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-orange-400 focus:border-transparent">
                            </div>
                            
                            <!-- Portfolio Upload Section -->
                            <div>
                                <label for="register-portfolio" class="block text-sm font-medium text-slate-700">Portfolio Images</label>
                                <input type="file" id="register-portfolio" accept="image/*" multiple 
                                       onchange="previewPortfolioImages(this)"
                                       class="mt-1 block w-full p-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-orange-400 focus:border-transparent">
                                <p class="text-xs text-slate-500 mt-1">Upload up to 10 portfolio images (JPG, PNG, WebP - will be optimized automatically)</p>
                                
                                <!-- Portfolio Preview Container -->
                                <div id="portfolio-images-preview" class="mt-3 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2"></div>
                                
                                <!-- Generate PDF Button -->
                                <div class="mt-3">
                                    <button type="button" id="generate-portfolio-pdf" onclick="generatePortfolioPDF()" 
                                            class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 text-sm disabled:opacity-50" 
                                            disabled>
                                        📄 Generate Portfolio PDF
                                    </button>
                                    <p class="text-xs text-slate-500 mt-1">Create a PDF portfolio for clients to download</p>
                                </div>
                            </div>
                        </div>

                        <button type="submit" onclick="if(window.handleRegisterBackup) { window.handleRegisterBackup(event); return false; }" class="w-full bg-slate-800 text-white font-bold py-3 rounded-md hover:bg-slate-700">Create Account</button>
                        <div id="register-error" class="hidden text-red-600 text-sm text-center"></div>
                        <div id="register-success" class="hidden text-green-600 text-sm text-center"></div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Client Booking Page -->
        <div id="book-photographer" class="page container mx-auto px-6 py-16">
            <div class="text-center mb-12">
                <h1 class="text-4xl font-bold font-serif-display">Book a Photographer</h1>
                <p class="text-lg text-slate-600 mt-2">Find and book the perfect photographer for your needs.</p>
            </div>

            <!-- Search and Filter Section -->
            <div class="mb-8 bg-white p-6 rounded-lg shadow-sm">
                <div class="grid md:grid-cols-4 gap-4">
                    <input type="text" id="search-photographer" placeholder="Search by name..." class="p-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-orange-400 focus:border-transparent">
                    <select id="filter-specialty" class="p-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-orange-400 focus:border-transparent">
                        <option value="">All Specialties</option>
                        <option value="weddings">Weddings</option>
                        <option value="portraits">Portraits</option>
                        <option value="events">Events</option>
                        <option value="commercial">Commercial</option>
                        <option value="fashion">Fashion</option>
                        <option value="nature">Nature</option>
                        <option value="street">Street</option>
                        <option value="sports">Sports</option>
                    </select>
                    <input type="text" id="filter-location" placeholder="Location (city)" class="p-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-orange-400 focus:border-transparent">
                    <button onclick="searchPhotographers()" class="bg-orange-500 text-white font-bold py-3 px-6 rounded-md hover:bg-orange-600">Search</button>
                </div>
            </div>

            <!-- Photographer Results -->
            <div id="photographer-results" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Results will be populated by JavaScript -->
            </div>
        </div>

        <!-- Photographer Dashboard -->
        <div id="photographer-dashboard-page" class="page container mx-auto px-6 py-16">
            <div class="text-center mb-12">
                <h1 class="text-4xl font-bold font-serif-display">My Recent Bookings</h1>
                <p class="text-lg text-slate-600 mt-2">View and manage your photography bookings and client details.</p>
            </div>

            <div class="grid lg:grid-cols-4 gap-8">
                <!-- Profile Summary -->
                <div class="lg:col-span-1">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-bold mb-4">Profile Summary</h3>
                        <div id="dashboard-profile-info">
                            <!-- Will be populated by JavaScript -->
                        </div>
                        <button onclick="console.log('Edit Profile clicked'); showPage('photographer-profile-edit')" class="w-full mt-4 bg-orange-500 text-white py-2 px-4 rounded-md hover:bg-orange-600">
                            Edit Profile
                        </button>
                        
                        <!-- Debug button for testing -->
                        <button onclick="testEditProfile()" class="w-full mt-2 bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 text-sm">
                            🔧 Test Edit Profile (Debug)
                        </button>
                    </div>
                    
                    <!-- Quick Stats -->
                    <div class="mt-6 space-y-4">
                        <div class="bg-white p-4 rounded-lg shadow-md text-center">
                            <h4 class="text-sm font-semibold text-slate-600">Total Bookings</h4>
                            <p class="text-2xl font-bold text-orange-500" id="total-bookings">0</p>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow-md text-center">
                            <h4 class="text-sm font-semibold text-slate-600">This Month</h4>
                            <p class="text-2xl font-bold text-orange-500" id="monthly-bookings">0</p>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow-md text-center">
                            <h4 class="text-sm font-semibold text-slate-600">Portfolio Items</h4>
                            <p class="text-2xl font-bold text-orange-500" id="portfolio-count">0</p>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow-md text-center">
                            <h4 class="text-sm font-semibold text-slate-600">Average Rating</h4>
                            <p class="text-2xl font-bold text-orange-500" id="average-rating">5.0</p>
                        </div>
                    </div>
                </div>

                <!-- Recent Bookings - Main Focus -->
                <div class="lg:col-span-3">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-bold mb-4">All Bookings & Client Details</h3>
                        <div id="dashboard-bookings">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Photographer Profile Edit -->
        <div id="photographer-profile-edit" class="page container mx-auto px-6 py-16">
            <div class="max-w-2xl mx-auto">
                <div class="bg-white p-8 rounded-lg shadow-md">
                    <h2 class="text-2xl font-bold mb-6">Edit Profile</h2>
                    <form id="photographer-profile-form" class="space-y-6">
                        
                        <!-- Profile Photo Section -->
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-2">Profile Photo</label>
                            <div class="flex items-center space-x-4">
                                <div id="current-profile-image" class="w-20 h-20 rounded-full bg-slate-200 overflow-hidden flex-shrink-0">
                                    <!-- Current photo will be displayed here -->
                                </div>
                                <div class="flex-1">
                                    <input type="file" id="edit-profile-photo" accept="image/*" 
                                           onchange="previewEditProfileImage(this)"
                                           class="block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-orange-50 file:text-orange-700 hover:file:bg-orange-100">
                                    <p class="text-xs text-slate-500 mt-1">Upload a new profile photo (JPG, PNG - will be optimized)</p>
                                </div>
                            </div>
                            <div id="edit-profile-image-preview" class="mt-3"></div>
                        </div>
                        
                        <!-- Basic Info -->
                        <div>
                            <label for="edit-name" class="block text-sm font-medium text-slate-700">Full Name</label>
                            <input type="text" id="edit-name" class="mt-1 block w-full p-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-orange-400 focus:border-transparent">
                        </div>
                        
                        <div>
                            <label for="edit-bio" class="block text-sm font-medium text-slate-700">Bio</label>
                            <textarea id="edit-bio" rows="4" class="mt-1 block w-full p-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-orange-400 focus:border-transparent"></textarea>
                        </div>
                        
                        <div>
                            <label for="edit-location" class="block text-sm font-medium text-slate-700">Location</label>
                            <input type="text" id="edit-location" placeholder="City, State or Available for travel" class="mt-1 block w-full p-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-orange-400 focus:border-transparent">
                        </div>
                        
                        <div>
                            <label for="edit-specialties" class="block text-sm font-medium text-slate-700">Specialties</label>
                            <select id="edit-specialties" multiple class="mt-1 block w-full p-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-orange-400 focus:border-transparent" style="height: 120px;">
                                <option value="weddings">Weddings</option>
                                <option value="portraits">Portraits</option>
                                <option value="events">Events</option>
                                <option value="commercial">Commercial</option>
                                <option value="fashion">Fashion</option>
                                <option value="nature">Nature</option>
                                <option value="street">Street Photography</option>
                                <option value="sports">Sports</option>
                                <option value="architecture">Architecture</option>
                                <option value="landscape">Landscape</option>
                                <option value="other">Other</option>
                            </select>
                            <p class="text-xs text-slate-500 mt-1">Hold Ctrl (or Cmd) to select multiple specialties</p>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="edit-hourly-rate" class="block text-sm font-medium text-slate-700">Hourly Rate ($)</label>
                                <input type="number" id="edit-hourly-rate" min="0" class="mt-1 block w-full p-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-orange-400 focus:border-transparent">
                            </div>
                            <div>
                                <label for="edit-experience" class="block text-sm font-medium text-slate-700">Years of Experience</label>
                                <input type="number" id="edit-experience" min="0" max="50" class="mt-1 block w-full p-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-orange-400 focus:border-transparent">
                            </div>
                        </div>
                        
                        <!-- Portfolio Management Section -->
                        <div>
                            <label class="block text-sm font-medium text-slate-700 mb-2">Portfolio Management</label>
                            <div class="border-2 border-dashed border-slate-300 rounded-lg p-4">
                                <div class="mb-4">
                                    <h4 class="font-medium text-slate-700 mb-2">Current Portfolio Images</h4>
                                    <div id="current-portfolio-images" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 mb-4">
                                        <!-- Current portfolio images will be displayed here -->
                                    </div>
                                </div>
                                
                                <div>
                                    <label for="edit-portfolio-images" class="block text-sm font-medium text-slate-700 mb-2">Add New Portfolio Images</label>
                                    <input type="file" id="edit-portfolio-images" accept="image/*" multiple 
                                           onchange="previewEditPortfolioImages(this)"
                                           class="block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-orange-50 file:text-orange-700 hover:file:bg-orange-100">
                                    <p class="text-xs text-slate-500 mt-1">Upload up to 10 new portfolio images (JPG, PNG, WebP - will be optimized)</p>
                                    <div id="edit-portfolio-preview" class="mt-3 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex gap-4">
                            <button type="submit" class="flex-1 bg-orange-500 text-white font-bold py-3 rounded-md hover:bg-orange-600">Save Changes</button>
                            <button type="button" onclick="showPage('photographer-dashboard-page')" class="flex-1 bg-slate-500 text-white font-bold py-3 rounded-md hover:bg-slate-600">Cancel</button>
                        </div>
                        <div id="profile-edit-error" class="hidden text-red-600 text-sm text-center"></div>
                        <div id="profile-edit-success" class="hidden text-green-600 text-sm text-center"></div>
                    </form>
                </div>
            </div>
        </div>

    </main>

    <!-- Booking Modal -->
    <div id="booking-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg p-8 max-w-2xl w-full mx-4 max-h-screen overflow-y-auto">
            <h3 class="text-xl font-bold mb-4">Book Photography Session</h3>
            
            <!-- Calendar Section -->
            <div class="mb-6">
                <h4 class="font-semibold mb-3">Select Date</h4>
                <div id="booking-calendar" class="border rounded-lg p-4"></div>
            </div>
            
            <!-- Time Selection Section -->
            <div id="time-selection" class="mb-6"></div>
            
            <form id="booking-form" class="space-y-4">
                <input type="hidden" id="selected-date">
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">Session Type</label>
                    <select id="session-type" class="w-full p-3 border border-slate-300 rounded-md">
                        <option value="portrait">Portrait Session</option>
                        <option value="wedding">Wedding Photography</option>
                        <option value="event">Event Photography</option>
                        <option value="commercial">Commercial Shoot</option>
                        <option value="family">Family Photos</option>
                        <option value="nature">Nature & Landscape</option>
                        <option value="fashion">Fashion Photography</option>
                        <option value="sports">Sports Photography</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">Duration (hours)</label>
                    <select id="session-duration" class="w-full p-3 border border-slate-300 rounded-md">
                        <option value="1">1 hour</option>
                        <option value="2">2 hours</option>
                        <option value="3">3 hours</option>
                        <option value="4">4 hours</option>
                        <option value="6">6 hours</option>
                        <option value="8">8 hours (Full Day)</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">Special Requirements</label>
                    <textarea id="special-requirements" class="w-full p-3 border border-slate-300 rounded-md" rows="3" placeholder="Any special requests or requirements..."></textarea>
                </div>
                <div class="flex gap-3 pt-4">
                    <button type="button" onclick="closeBookingModal()" class="flex-1 bg-slate-500 text-white py-3 rounded-md hover:bg-slate-600">Cancel</button>
                    <button type="submit" class="flex-1 bg-orange-500 text-white py-3 rounded-md hover:bg-orange-600 font-semibold">Confirm Booking</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-slate-900 text-white">
        <div class="container mx-auto px-6 py-12">
            <div class="grid md:grid-cols-3 gap-8">
                <div>
                    <h3 class="text-xl font-bold font-serif-display mb-4">LensLink</h3>
                    <p class="text-slate-400">The modern way to book professional photography services.</p>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">Quick Links</h4>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-slate-400 hover:text-white" data-page="about">About Us</a></li>
                        <li><a href="#" class="text-slate-400 hover:text-white" data-page="contact">Contact</a></li>
                        <li><a href="#" class="text-slate-400 hover:text-white" data-page="login">My Account</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">Contact</h4>
                    <p class="text-slate-400">saikumarreddyappidi9@gmail.com</p>
                    <p class="text-slate-400">989889899</p>
                </div>
            </div>
            <div class="mt-8 pt-8 border-t border-slate-700 text-center text-slate-500 text-sm">
                <p>&copy; 2025 LensLink. All Rights Reserved to SaiKumarReddy.</p>
            </div>
        </div>
    </footer>

    <script>
        // 🚀 Railway Backend Integration
    const API_BASE_URL = '/api'; // Proxy via Netlify redirects to Railway backend
        let backendAvailable = false;
        
        // Test backend connection
        async function testBackendConnection() {
            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                const result = await response.json();
                console.log('✅ Railway Backend Connected:', result);
                backendAvailable = true;
                
                // Update UI to show backend status
                updateBackendStatus(true);
                return true;
            } catch (error) {
                console.warn('⚠️ Railway Backend unavailable, using localStorage fallback');
                backendAvailable = false;
                updateBackendStatus(false);
                return false;
            }
        }
        
        // Update backend status in UI
        function updateBackendStatus(connected) {
            // Update the LocalStorage Database badge
            const badges = document.querySelectorAll('.bg-indigo-100');
            badges.forEach(badge => {
                if (badge.textContent.includes('LocalStorage')) {
                    badge.className = connected ? 'bg-green-100 text-green-800 text-sm font-medium px-3 py-1 rounded-full' : 'bg-indigo-100 text-indigo-800 text-sm font-medium px-3 py-1 rounded-full';
                    badge.textContent = connected ? 'Railway Cloud Database ☁️' : 'LocalStorage Database 💾';
                }
            });
            
            // Update database description
            const descriptions = document.querySelectorAll('p');
            descriptions.forEach(p => {
                if (p.textContent.includes('Browser LocalStorage')) {
                    p.textContent = connected ? 
                        'Railway cloud database for cross-device authentication and data persistence' :
                        'Browser LocalStorage for persistent user data, bookings, and photographer profiles';
                }
            });
        }
        
        // API Helper Function
        async function apiCall(endpoint, options = {}) {
            if (!backendAvailable) {
                throw new Error('Backend not available');
            }
            
            const token = localStorage.getItem('authToken');
            const headers = {
                'Content-Type': 'application/json',
                ...options.headers
            };
            
            if (token && endpoint !== '/health') {
                headers['Authorization'] = `Bearer ${token}`;
            }
            
            const response = await fetch(`${API_BASE_URL}${endpoint}`, {
                ...options,
                headers
            });
            
            if (!response.ok) {
                throw new Error(`API Error: ${response.status}`);
            }
            
            return await response.json();
        }
        
        // Enhanced Authentication Functions
        async function registerUserWithBackend(userData) {
            if (backendAvailable) {
                try {
                    const response = await apiCall('/auth/register', {
                        method: 'POST',
                        body: JSON.stringify(userData)
                    });
                    
                    showAlert('✅ Account created successfully with cloud backup!', 'success');
                    return response;
                } catch (error) {
                    console.warn('Backend registration failed, using localStorage');
                }
            }
            
            // Fallback to localStorage
            const users = JSON.parse(localStorage.getItem(STORAGE_KEYS.users) || '[]');
            const existingUser = users.find(u => u.email === userData.email);
            
            if (existingUser) {
                throw new Error('User already exists');
            }
            
            const newUser = {
                id: Date.now().toString(),
                ...userData,
                createdAt: new Date().toISOString()
            };
            
            users.push(newUser);
            localStorage.setItem(STORAGE_KEYS.users, JSON.stringify(users));
            showAlert('✅ Account created successfully (local storage)', 'success');
            return { user: newUser };
        }
        
        async function loginUserWithBackend(credentials) {
            if (backendAvailable) {
                try {
                    const response = await apiCall('/auth/login', {
                        method: 'POST',
                        body: JSON.stringify(credentials)
                    });
                    
                    localStorage.setItem('authToken', response.token);
                    localStorage.setItem(STORAGE_KEYS.currentUser, JSON.stringify(response.user));
                    currentUser = response.user;
                    
                    showAlert('✅ Login successful with cloud sync!', 'success');
                    return response;
                } catch (error) {
                    console.warn('Backend login failed, trying localStorage');
                }
            }
            
            // Fallback to localStorage
            const users = JSON.parse(localStorage.getItem(STORAGE_KEYS.users) || '[]');
            const user = users.find(u => u.email === credentials.email);
            
            if (!user) {
                throw new Error('Invalid email or password');
            }
            
            localStorage.setItem(STORAGE_KEYS.currentUser, JSON.stringify(user));
            currentUser = user;
            showAlert('✅ Login successful (local storage)', 'success');
            return { user };
        }
        
        // Initialize backend connection on page load - MOVED TO MAIN DOMContentLoaded
        // document.addEventListener('DOMContentLoaded', function() {
        //     testBackendConnection();
        // });
        
        // Local Storage Configuration (Enhanced with Backend Integration)
        const STORAGE_KEYS = {
            users: 'lenslink_users',
            currentUser: 'lenslink_current_user',
            photographers: 'lenslink_photographers'
        };
        
        // State Management
        let currentUser = null;
        let allUsers = [];
        let allPhotographers = [];

        // Global Page Navigation Function - Make globally accessible
        window.showPage = function(pageId) {
            console.log('📍 Navigating to page:', pageId);
            
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => {
                page.classList.remove('active');
            });
            const activePage = document.getElementById(pageId);
            if (activePage) {
                activePage.classList.add('active');
                window.scrollTo(0, 0);
                console.log('✅ Page activated:', pageId);
            } else {
                console.error('❌ Page not found:', pageId);
            }
            
            // Load specific page data
            setTimeout(() => {
                if (pageId === 'find-photographers') {
                    loadRegisteredPhotographers();
                } else if (pageId === 'book-photographer') {
                    displayPhotographersInBookingPage(allPhotographers);
                } else if (pageId === 'photographer-dashboard-page') {
                    if (currentUser && currentUser.role === 'photographer') {
                        loadPhotographerDashboard();
                    }
                }
            }, 100);
        }

        // Load data from localStorage
        function loadFromLocalStorage() {
            allUsers = JSON.parse(localStorage.getItem(STORAGE_KEYS.users) || '[]');
            allPhotographers = JSON.parse(localStorage.getItem(STORAGE_KEYS.photographers) || '[]');
            const savedUser = localStorage.getItem(STORAGE_KEYS.currentUser);
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
            }
        }

        // Save data to localStorage
        function saveToLocalStorage() {
            try {
                console.log('💾 Attempting to save to localStorage...');
                
                // Check if localStorage is available
                if (typeof Storage === "undefined") {
                    throw new Error('LocalStorage is not supported in this browser');
                }
                
                // Save users
                console.log('💾 Saving users:', allUsers.length, 'users');
                localStorage.setItem(STORAGE_KEYS.users, JSON.stringify(allUsers));
                
                // Save photographers  
                console.log('💾 Saving photographers:', allPhotographers.length, 'photographers');
                localStorage.setItem(STORAGE_KEYS.photographers, JSON.stringify(allPhotographers));
                
                // Save current user
                if (currentUser) {
                    console.log('💾 Saving current user:', currentUser.name);
                    localStorage.setItem(STORAGE_KEYS.currentUser, JSON.stringify(currentUser));
                }
                
                console.log('✅ Successfully saved all data to localStorage');
                return true;
                
            } catch (error) {
                console.error('❌ Failed to save to localStorage:', error);
                
                // Check for storage quota exceeded
                if (error.name === 'QuotaExceededError' || error.code === 22) {
                    console.error('❌ Storage quota exceeded - try clearing browser data');
                    throw new Error('Storage quota exceeded. Please clear browser data and try again.');
                }
                
                throw error;
            }
        }

        // DOM Elements
        const authButtons = document.getElementById('auth-buttons');
        const userMenu = document.getElementById('user-menu');
        const userWelcome = document.getElementById('user-welcome');
        const userName = document.getElementById('user-name');
        const userAvatar = document.getElementById('user-avatar');
        const photographerMenu = document.getElementById('photographer-menu');

        // Global Page Navigation Function - Make globally accessible
        window.showPage = function(pageId) {
            console.log('📍 Navigating to page:', pageId);
            
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => {
                page.classList.remove('active');
            });
            const activePage = document.getElementById(pageId);
            if (activePage) {
                activePage.classList.add('active');
                window.scrollTo(0, 0);
                console.log('✅ Page activated:', pageId);
            } else {
                console.error('❌ Page not found:', pageId);
            }
            
            // Load specific page data
            setTimeout(() => {
                if (pageId === 'find-photographers') {
                    loadRegisteredPhotographers();
                } else if (pageId === 'book-photographer') {
                    displayPhotographersInBookingPage(allPhotographers);
                } else if (pageId === 'photographer-dashboard-page') {
                    if (currentUser && currentUser.role === 'photographer') {
                        loadPhotographerDashboard();
                    }
                } else if (pageId === 'user-profile') {
                    displayUserProfile();
                } else if (pageId === 'login') {
                    // Ensure login form is set up properly
                    initializeLoginPage();
                } else if (pageId === 'photographer-profile-edit') {
                    // Initialize edit profile page with current user data
                    console.log('🎨 Attempting to initialize edit profile page');
                    if (typeof initializeEditProfile === 'function') {
                        initializeEditProfile();
                    } else {
                        console.error('❌ initializeEditProfile function not found');
                        // Try alternative approach
                        setTimeout(() => {
                            if (window.initializeEditProfile) {
                                window.initializeEditProfile();
                            } else {
                                console.log('🔄 Manually initializing edit profile');
                                manuallyInitializeEditProfile();
                            }
                        }, 100);
                    }
                }
            }, 100);
        }

        // Authentication Functions (Enhanced with Backend Integration) - MOVED BEFORE DOMContentLoaded
        async function handleLogin(e) {
            e.preventDefault();
            
            const emailInput = document.getElementById('login-email');
            const passwordInput = document.getElementById('login-password');
            
            if (!emailInput || !passwordInput) {
                console.error('Login form inputs not found');
                return;
            }
            
            const email = emailInput.value;
            const password = passwordInput.value;
            
            // Basic validation
            if (!email.trim()) {
                showMessage('login-error', 'Please enter your email address', 'error');
                return;
            }
            
            if (!password.trim()) {
                showMessage('login-error', 'Please enter your password', 'error');
                return;
            }
            
            clearMessages();
            showLoading('login-form', true);

            try {
                // Fallback to localStorage
                loadFromLocalStorage();
                
                const user = allUsers.find(u => u.email.toLowerCase() === email.toLowerCase());
                
                if (user && user.password === password) {
                    currentUser = user;
                    localStorage.setItem(STORAGE_KEYS.currentUser, JSON.stringify(currentUser));
                    
                    showMessage('login-success', 'Login successful! Redirecting...', 'success');
                    
                    setTimeout(() => {
                        updateUI();
                        
                        // Clear form
                        emailInput.value = '';
                        passwordInput.value = '';
                        
                        if (currentUser.role === 'photographer') {
                            showPage('photographer-dashboard-page');
                            loadPhotographerDashboard();
                        } else {
                            showPage('find-photographers');
                            loadRegisteredPhotographers();
                        }
                    }, 1000);
                } else {
                    showMessage('login-error', 'Invalid email or password', 'error');
                }
            } catch (error) {
                console.error('Login error:', error);
                showMessage('login-error', 'Login failed. Please try again.', 'error');
            } finally {
                showLoading('login-form', false);
            }
        }

        // Register function
        async function handleRegister(e) {
            e.preventDefault();
            console.log('🚀 Register function called');
            
            // Get form values
            const name = document.getElementById('register-name')?.value;
            const email = document.getElementById('register-email')?.value;
            const password = document.getElementById('register-password')?.value;
            const role = document.getElementById('register-role')?.value;
            const phone = document.getElementById('register-phone')?.value;
            
            // Basic validation
            if (!name || !email || !password || !role) {
                showMessage('register-error', 'Please fill in all required fields', 'error');
                return;
            }
            
            if (password.length < 6) {
                showMessage('register-error', 'Password must be at least 6 characters long', 'error');
                return;
            }
            
            clearMessages();
            showLoading('register-form', true);
            
            try {
                // Check if user already exists
                loadFromLocalStorage();
                const existingUser = allUsers.find(u => u.email.toLowerCase() === email.toLowerCase());
                
                if (existingUser) {
                    showMessage('register-error', 'An account with this email already exists', 'error');
                    return;
                }
                
                // Create new user
                const newUser = {
                    id: Date.now().toString(),
                    name,
                    email,
                    password,
                    role,
                    phone,
                    createdAt: new Date().toISOString()
                };
                
                // Add photographer-specific fields
                if (role === 'photographer') {
                    newUser.location = document.getElementById('register-location')?.value || '';
                    newUser.experience = document.getElementById('register-experience')?.value || '1';
                    newUser.hourlyRate = document.getElementById('register-rate')?.value || '100';
                    newUser.specialties = ['Portrait', 'Wedding']; // Default specialties
                    newUser.portfolio = [];
                }
                
                // Save user
                allUsers.push(newUser);
                if (role === 'photographer') {
                    allPhotographers.push(newUser);
                }
                
                currentUser = newUser;
                saveToLocalStorage();
                
                showMessage('register-success', 'Registration successful! Redirecting...', 'success');
                
                setTimeout(() => {
                    updateUI();
                    
                    if (role === 'photographer') {
                        showPage('photographer-dashboard-page');
                        loadPhotographerDashboard();
                    } else {
                        showPage('find-photographers');
                        loadRegisteredPhotographers();
                    }
                }, 1000);
                
            } catch (error) {
                console.error('Registration error:', error);
                showMessage('register-error', 'Registration failed. Please try again.', 'error');
            } finally {
                showLoading('register-form', false);
            }
        }

        // Make functions globally accessible
        window.handleLogin = handleLogin;
        window.handleRegister = handleRegister;

        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 DOM Content Loaded - Initializing LensLink');
            
            // Test backend connection first
            testBackendConnection();
            
            // Load data from localStorage first
            loadFromLocalStorage();
            
            // Initialize sample data if none exists
            initializeSampleData();
            
            // Initialize the app
            initializeApp();
            
            console.log('📊 Loaded users:', allUsers.length, 'photographers:', allPhotographers.length);
            
            // Add emergency fix for broken registration function
            window.handleRegisterBackup = function(e) {
                e.preventDefault();
                console.log('🆘 Using backup registration function');
                
                const name = document.getElementById('register-name').value;
                const email = document.getElementById('register-email').value;
                const password = document.getElementById('register-password').value;
                const role = document.getElementById('register-role').value;
                const phone = document.getElementById('register-phone').value;
                
                if (!name || !email || !password) {
                    alert('Please fill in all required fields');
                    return;
                }
                
                // Check if user exists
                if (allUsers.find(u => u.email === email)) {
                    alert('Email already registered');
                    return;
                }
                
                // Handle profile image
                let profileImage = `https://placehold.co/100x100/94a3b8/ffffff?text=${name.charAt(0)}`;
                const photoInput = document.getElementById('register-profile-photo');
                if (photoInput && photoInput.compressedImage) {
                    profileImage = photoInput.compressedImage;
                    console.log('✅ Using compressed profile image from backup function');
                }
                
                const newUser = {
                    id: 'user_' + Date.now(),
                    name, email, password, role, phone,
                    profileImage: profileImage
                };
                
                if (role === 'photographer') {
                    newUser.bio = document.getElementById('register-bio').value || 'Professional photographer';
                    newUser.specialties = ['portraits'];
                    newUser.hourlyRate = 150;
                    newUser.experience = 1;
                    newUser.location = document.getElementById('register-location').value || 'Available for travel';
                    
                    // Handle portfolio images from global portfolioImages array
                    try {
                        newUser.portfolio = portfolioImages && portfolioImages.length > 0 
                            ? portfolioImages.map(img => ({
                                name: img.name,
                                data: img.compressedData,
                                uploadDate: new Date().toISOString()
                            }))
                            : [];
                        console.log('✅ Added portfolio images to backup registration:', newUser.portfolio.length, 'images');
                    } catch (error) {
                        console.warn('⚠️ Portfolio processing failed in backup function:', error);
                        newUser.portfolio = [];
                    }
                    
                    allPhotographers.push(newUser);
                }
                
                allUsers.push(newUser);
                currentUser = newUser;
                saveToLocalStorage();
                
                alert('Registration successful!');
                updateUI();
                showPage(role === 'photographer' ? 'photographer-dashboard-page' : 'find-photographers');
            };
            
            // Add emergency backup for login function
            window.handleLoginBackup = function(e) {
                e.preventDefault();
                console.log('🆘 Using backup login function');
                
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                
                if (!email || !password) {
                    alert('Please enter email and password');
                    return;
                }
                
                const user = allUsers.find(u => u.email.toLowerCase() === email.toLowerCase() && u.password === password);
                
                if (user) {
                    currentUser = user;
                    localStorage.setItem(STORAGE_KEYS.currentUser, JSON.stringify(currentUser));
                    alert('Login successful!');
                    updateUI();
                    showPage(user.role === 'photographer' ? 'photographer-dashboard-page' : 'find-photographers');
                } else {
                    alert('Invalid email or password');
                }
            };

            // --- Page Navigation ---
            const navLinks = document.querySelectorAll('a[data-page]');

            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const pageId = link.getAttribute('data-page');
                    showPage(pageId);
                    // Close mobile menu on navigation
                    const mobileMenu = document.getElementById('mobile-menu');
                    if(mobileMenu && !mobileMenu.classList.contains('hidden')) {
                        mobileMenu.classList.add('hidden');
                    }
                });
            });

            // --- Mobile Menu ---
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            if (mobileMenuButton && mobileMenu) {
                mobileMenuButton.addEventListener('click', () => {
                    mobileMenu.classList.toggle('hidden');
                });
            }

            // --- User Menu Dropdown ---
            const userMenuButton = document.getElementById('user-menu-button');
            const userDropdown = document.getElementById('user-dropdown');
            if (userMenuButton && userDropdown) {
                userMenuButton.addEventListener('click', () => {
                    userDropdown.classList.toggle('hidden');
                });

                // Close dropdown when clicking outside
                document.addEventListener('click', (e) => {
                    if (!userMenuButton.contains(e.target) && !userDropdown.contains(e.target)) {
                        userDropdown.classList.add('hidden');
                    }
                });
            }

            // --- Login/Register Tabs ---
            const loginTab = document.getElementById('login-tab');
            const registerTab = document.getElementById('register-tab');
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            const registerRole = document.getElementById('register-role');
            const photographerInfo = document.getElementById('photographer-info');

            console.log('🔍 Login/Register elements found:', {
                loginTab: !!loginTab,
                registerTab: !!registerTab, 
                loginForm: !!loginForm,
                registerForm: !!registerForm
            });

            if(loginTab && registerTab && loginForm && registerForm){
                // Show/hide photographer fields based on role selection
                if (registerRole && photographerInfo) {
                    registerRole.addEventListener('change', function() {
                        if (this.value === 'photographer') {
                            photographerInfo.classList.remove('hidden');
                        } else {
                            photographerInfo.classList.add('hidden');
                        }
                    });
                }

                loginTab.addEventListener('click', () => {
                    console.log('📝 Login tab clicked');
                    loginTab.classList.add('border-orange-500', 'text-orange-500');
                    loginTab.classList.remove('text-slate-500');
                    registerTab.classList.remove('border-orange-500', 'text-orange-500');
                    registerTab.classList.add('text-slate-500');
                    loginForm.style.display = 'block';
                    registerForm.style.display = 'none';
                    clearMessages();
                });

                registerTab.addEventListener('click', () => {
                    console.log('📝 Register tab clicked');
                    registerTab.classList.add('border-orange-500', 'text-orange-500');
                    registerTab.classList.remove('text-slate-500');
                    loginTab.classList.remove('border-orange-500', 'text-orange-500');
                    loginTab.classList.add('text-slate-500');
                    loginForm.style.display = 'none';
                    registerForm.style.display = 'block';
                    clearMessages();
                });

                // Login Form Handler - Ensure it's always attached
                console.log('🔗 Attaching login form handler');
                loginForm.removeEventListener('submit', handleLogin); // Remove any existing listener
                try {
                    loginForm.addEventListener('submit', handleLogin);
                } catch (error) {
                    console.warn('⚠️ Main login handler failed, using backup');
                    loginForm.addEventListener('submit', handleLoginBackup);
                }

                // Register Form Handler - Ensure it's always attached  
                console.log('🔗 Attaching register form handler');
                registerForm.removeEventListener('submit', handleRegister); // Remove any existing listener
                try {
                    registerForm.addEventListener('submit', handleRegister);
                } catch (error) {
                    console.warn('⚠️ Main register handler failed, using backup');
                    registerForm.addEventListener('submit', handleRegisterBackup);
                }
                
                console.log('✅ Login/Register forms initialized successfully');
            } else {
                console.error('❌ Login/Register form elements not found');
            }

            // --- User Menu Actions ---
            const myBookings = document.getElementById('my-bookings');
            const myProfile = document.getElementById('my-profile');
            const myRecentBookings = document.getElementById('my-recent-bookings');
            const findPhotographersLink = document.getElementById('find-photographers-link');

            if (myBookings) {
                myBookings.addEventListener('click', (e) => {
                    e.preventDefault();
                    if (currentUser && currentUser.role === 'client') {
                        showPage('book-photographer');
                    } else {
                        showPage('photographer-dashboard-page');
                    }
                });
            }

            if (findPhotographersLink) {
                findPhotographersLink.addEventListener('click', (e) => {
                    e.preventDefault();
                    showPage('find-photographers');
                    loadRegisteredPhotographers();
                });
            }

            if (myRecentBookings) {
                myRecentBookings.addEventListener('click', (e) => {
                    e.preventDefault();
                    showPage('photographer-dashboard-page');
                    setTimeout(() => {
                        loadPhotographerDashboard();
                    }, 100);
                });
            }

            if (myProfile) {
                myProfile.addEventListener('click', (e) => {
                    e.preventDefault();
                    showPage('user-profile');
                    displayUserProfile();
                });
            }

            // --- Photographer Profile Form ---
            const photographerProfileForm = document.getElementById('photographer-profile-form');
            if (photographerProfileForm) {
                photographerProfileForm.addEventListener('submit', handlePhotographerProfileUpdate);
            }

            // --- Logout Handler ---
            const logoutBtn = document.getElementById('logout-btn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    handleLogout();
                });
            }

            // --- Datepicker for Profile Page ---
            const datepickerEl = document.getElementById('datepicker');
            if (datepickerEl) {
                // Get some dates to disable for demonstration
                const tomorrow = new Date();
                tomorrow.setDate(tomorrow.getDate() + 1);
                const dayAfter = new Date();
                dayAfter.setDate(dayAfter.getDate() + 4);

                flatpickr(datepickerEl, {
                    inline: true,
                    minDate: "today",
                    dateFormat: "Y-m-d",
                    disable: [tomorrow, dayAfter], // Example of disabled dates
                    onChange: function(selectedDates, dateStr, instance) {
                        const bookingDateInput = document.getElementById('booking-date');
                        if (bookingDateInput) {
                            bookingDateInput.value = dateStr;
                        }
                    }
                });
            }
            
            // Set initial page
            showPage('home');
            
            // Load photographers on home page
            loadPhotographers();
            
            // Check for current user and update UI
            if (currentUser) {
                updateUI();
            }
            
            // Make edit profile functions globally accessible
            window.initializeEditProfile = initializeEditProfile;
            window.manuallyInitializeEditProfile = manuallyInitializeEditProfile;
        });

        // --- Local Storage Functions (No API needed) ---
        function initializeSampleData() {
            // Add sample photographers if none exist
            if (allPhotographers.length === 0) {
                const samplePhotographers = [
                    {
                        id: 'photo1',
                        name: 'Jane Doe',
                        email: 'jane@example.com',
                        password: 'password123',
                        role: 'photographer',
                        specialties: ['weddings', 'portraits'],
                        bio: 'Professional wedding and portrait photographer with 10+ years experience. Specializing in capturing timeless moments.',
                        hourlyRate: 200,
                        experience: 10,
                        location: 'New York, NY',
                        profileImage: 'https://placehold.co/400x400/a78bfa/ffffff?text=Jane+Doe',
                        portfolio: [
                            'https://placehold.co/600x400/fefce8/a16207?text=Wedding+1',
                            'https://placehold.co/600x400/ecfccb/4d7c0f?text=Wedding+2',
                            'https://placehold.co/600x400/f0f9ff/0ea5e9?text=Portrait+1',
                            'https://placehold.co/600x400/fef2f2/be123c?text=Portrait+2'
                        ]
                    },
                    {
                        id: 'photo2',
                        name: 'John Smith',
                        email: 'john@example.com',
                        password: 'password123',
                        role: 'photographer',
                        specialties: ['events', 'commercial'],
                        bio: 'Event and commercial photographer specializing in corporate events and brand photography.',
                        hourlyRate: 150,
                        experience: 8,
                        location: 'Los Angeles, CA',
                        profileImage: 'https://placehold.co/400x400/f87171/ffffff?text=John+Smith',
                        portfolio: [
                            'https://placehold.co/600x400/f0f9ff/0ea5e9?text=Event+1',
                            'https://placehold.co/600x400/fef2f2/be123c?text=Commercial+1',
                            'https://placehold.co/600x400/ecfccb/4d7c0f?text=Event+2',
                            'https://placehold.co/600x400/fefce8/a16207?text=Commercial+2'
                        ]
                    },
                    {
                        id: 'photo3',
                        name: 'Emily White',
                        email: 'emily@example.com',
                        password: 'password123',
                        role: 'photographer',
                        specialties: ['portraits', 'family'],
                        bio: 'Family and lifestyle photographer capturing authentic moments and connections.',
                        hourlyRate: 180,
                        experience: 6,
                        location: 'Chicago, IL',
                        profileImage: 'https://placehold.co/400x400/60a5fa/ffffff?text=Emily+White',
                        portfolio: [
                            'https://placehold.co/600x400/ecfccb/4d7c0f?text=Family+1',
                            'https://placehold.co/600x400/fefce8/a16207?text=Portrait+1',
                            'https://placehold.co/600x400/f0f9ff/0ea5e9?text=Family+2',
                            'https://placehold.co/600x400/fef2f2/be123c?text=Portrait+2'
                        ]
                    },
                    {
                        id: 'photo4',
                        name: 'Michael Johnson',
                        email: 'michael@example.com',
                        password: 'password123',
                        role: 'photographer',
                        specialties: ['nature', 'landscape'],
                        bio: 'Nature and landscape photographer with expertise in outdoor photography and adventure shoots.',
                        hourlyRate: 170,
                        experience: 12,
                        location: 'Denver, CO',
                        profileImage: 'https://placehold.co/400x400/34d399/ffffff?text=Michael+J',
                        portfolio: [
                            'https://placehold.co/600x400/ecfccb/4d7c0f?text=Nature+1',
                            'https://placehold.co/600x400/fefce8/a16207?text=Landscape+1',
                            'https://placehold.co/600x400/f0f9ff/0ea5e9?text=Nature+2',
                            'https://placehold.co/600x400/fef2f2/be123c?text=Landscape+2'
                        ]
                    },
                    {
                        id: 'photo5',
                        name: 'Sarah Davis',
                        email: 'sarah@example.com',
                        password: 'password123',
                        role: 'photographer',
                        specialties: ['fashion', 'portraits'],
                        bio: 'Fashion and portrait photographer creating stunning editorial and commercial images.',
                        hourlyRate: 250,
                        experience: 9,
                        location: 'Miami, FL',
                        profileImage: 'https://placehold.co/400x400/f472b6/ffffff?text=Sarah+D',
                        portfolio: [
                            'https://placehold.co/600x400/fefce8/a16207?text=Fashion+1',
                            'https://placehold.co/600x400/ecfccb/4d7c0f?text=Fashion+2',
                            'https://placehold.co/600x400/f0f9ff/0ea5e9?text=Portrait+1',
                            'https://placehold.co/600x400/fef2f2/be123c?text=Portrait+2'
                        ]
                    },
                    {
                        id: 'photo6',
                        name: 'David Wilson',
                        email: 'david@example.com',
                        password: 'password123',
                        role: 'photographer',
                        specialties: ['sports', 'action'],
                        bio: 'Sports and action photographer capturing dynamic moments in athletic events.',
                        hourlyRate: 190,
                        experience: 7,
                        location: 'Austin, TX',
                        profileImage: 'https://placehold.co/400x400/ef4444/ffffff?text=David+W',
                        portfolio: [
                            'https://placehold.co/600x400/ecfccb/4d7c0f?text=Sports+1',
                            'https://placehold.co/600x400/fefce8/a16207?text=Action+1',
                            'https://placehold.co/600x400/f0f9ff/0ea5e9?text=Sports+2',
                            'https://placehold.co/600x400/fef2f2/be123c?text=Action+2'
                        ]
                    },
                    {
                        id: 'photo7',
                        name: 'Lisa Chen',
                        email: 'lisa@example.com',
                        password: 'password123',
                        role: 'photographer',
                        specialties: ['weddings', 'events'],
                        bio: 'Wedding and event photographer specializing in cultural celebrations and intimate ceremonies.',
                        hourlyRate: 220,
                        experience: 8,
                        location: 'San Francisco, CA',
                        profileImage: 'https://placehold.co/400x400/8b5cf6/ffffff?text=Lisa+C',
                        portfolio: [
                            'https://placehold.co/600x400/fefce8/a16207?text=Wedding+1',
                            'https://placehold.co/600x400/ecfccb/4d7c0f?text=Wedding+2',
                            'https://placehold.co/600x400/f0f9ff/0ea5e9?text=Event+1',
                            'https://placehold.co/600x400/fef2f2/be123c?text=Event+2'
                        ]
                    },
                    {
                        id: 'photo8',
                        name: 'Robert Brown',
                        email: 'robert@example.com',
                        password: 'password123',
                        role: 'photographer',
                        specialties: ['commercial', 'architecture'],
                        bio: 'Commercial and architectural photographer with expertise in real estate and interior design.',
                        hourlyRate: 160,
                        experience: 11,
                        location: 'Seattle, WA',
                        profileImage: 'https://placehold.co/400x400/06b6d4/ffffff?text=Robert+B',
                        portfolio: [
                            'https://placehold.co/600x400/ecfccb/4d7c0f?text=Architecture+1',
                            'https://placehold.co/600x400/fefce8/a16207?text=Commercial+1',
                            'https://placehold.co/600x400/f0f9ff/0ea5e9?text=Architecture+2',
                            'https://placehold.co/600x400/fef2f2/be123c?text=Commercial+2'
                        ]
                    }
                ];
                
                allPhotographers = samplePhotographers;
                allUsers = [...allUsers, ...samplePhotographers];
                saveToLocalStorage();
            }
            
            // Add sample bookings if none exist for testing
            const existingBookings = JSON.parse(localStorage.getItem('lenslink_bookings') || '[]');
            if (existingBookings.length === 0) {
                const sampleBookings = [
                    {
                        id: 'booking_' + Date.now(),
                        photographerId: 'photo1', // Jane Doe
                        photographerName: 'Jane Doe',
                        clientId: 'client1',
                        clientName: 'Sarah Johnson',
                        clientEmail: 'sarah.johnson@example.com',
                        clientPhone: '+1-555-0104',
                        clientProfileImage: 'https://placehold.co/400x400/34d399/ffffff?text=Sarah',
                        date: '2025-08-15',
                        time: '14:00',
                        sessionType: 'Portrait Session',
                        duration: 2,
                        requirements: 'Outdoor location preferred, natural lighting',
                        totalCost: 400,
                        status: 'pending',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    },
                    {
                        id: 'booking_' + (Date.now() + 1),
                        photographerId: 'photo1', // Jane Doe
                        photographerName: 'Jane Doe',
                        clientId: 'client2',
                        clientName: 'Mark Thompson',
                        clientEmail: 'mark.thompson@example.com',
                        clientPhone: '+1-555-0105',
                        clientProfileImage: 'https://placehold.co/400x400/ef4444/ffffff?text=Mark',
                        date: '2025-08-20',
                        time: '10:00',
                        sessionType: 'Wedding Photography',
                        duration: 6,
                        requirements: 'Full wedding coverage needed',
                        totalCost: 1200,
                        status: 'confirmed',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    },
                    {
                        id: 'booking_' + (Date.now() + 2),
                        photographerId: 'photo2', // John Smith
                        photographerName: 'John Smith',
                        clientId: 'client3',
                        clientName: 'Emma Wilson',
                        clientEmail: 'emma.wilson@example.com',
                        clientPhone: '+1-555-0106',
                        clientProfileImage: 'https://placehold.co/400x400/8b5cf6/ffffff?text=Emma',
                        date: '2025-08-25',
                        time: '16:30',
                        sessionType: 'Event Photography',
                        duration: 4,
                        requirements: 'Corporate event, professional headshots needed',
                        totalCost: 600,
                        status: 'completed',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    }
                ];
                
                localStorage.setItem('lenslink_bookings', JSON.stringify(sampleBookings));
            }
        }

        // Authentication Functions (Enhanced with Backend Integration)
        async function handleLogin(e) {
            e.preventDefault();
            
            const emailInput = document.getElementById('login-email');
            const passwordInput = document.getElementById('login-password');
            
            if (!emailInput || !passwordInput) {
                console.error('Login form inputs not found');
                return;
            }
            
            const email = emailInput.value;
            const password = passwordInput.value;
            
            // Basic validation
            if (!email.trim()) {
                showMessage('login-error', 'Please enter your email address', 'error');
                return;
            }
            
            if (!password.trim()) {
                showMessage('login-error', 'Please enter your password', 'error');
                return;
            }
            
            clearMessages();
            showLoading('login-form', true);

            try {
                // Try backend login first if available
                if (backendAvailable) {
                    await loginUserWithBackend({ email, password });
                    updateUIAfterLogin();
                    navigateTo('user-dashboard');
                    emailInput.value = '';
                    passwordInput.value = '';
                    return;
                }
                
                // Fallback to localStorage
                loadFromLocalStorage();
                
                const user = allUsers.find(u => u.email.toLowerCase() === email.toLowerCase());
                
                if (user && user.password === password) {
                    currentUser = user;
                    localStorage.setItem(STORAGE_KEYS.currentUser, JSON.stringify(currentUser));
                    
                    showMessage('login-success', 'Login successful! Redirecting...', 'success');
                    
                    setTimeout(() => {
                        updateUI();
                        
                        // Clear form
                        emailInput.value = '';
                        passwordInput.value = '';
                        
                        if (currentUser.role === 'photographer') {
                            showPage('photographer-dashboard-page');
                            loadPhotographerDashboard();
                        } else {
                            showPage('find-photographers');
                            loadRegisteredPhotographers();
                        }
                    }, 1000);
                } else {
                    showMessage('login-error', 'Invalid email or password', 'error');
                }
            } catch (error) {
                console.error('Login error:', error);
                showMessage('login-error', 'Login failed. Please try again.', 'error');
            } finally {
                showLoading('login-form', false);
            }
        }

        // Make login function globally accessible
        window.handleLogin = handleLogin;

        let isRegistering = false; // Prevent double registration
        
        async function handleRegister(e) {
            e.preventDefault();
            
            // Prevent double submission
            if (isRegistering) {
                console.log('⚠️ Registration already in progress, ignoring duplicate submission');
                return;
            }
            
            isRegistering = true;
            console.log('🚀 Registration started');
            
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const role = document.getElementById('register-role').value;
            const phone = document.getElementById('register-phone').value;
            
            console.log('📝 Registration data:', { name, email, role, phone });
            
            try {
                // Basic validation
                if (!name.trim()) {
                    showMessage('register-error', 'Please enter your full name', 'error');
                    return;
                }
                
                if (!email.trim()) {
                    showMessage('register-error', 'Please enter your email address', 'error');
                    return;
                }
                
                if (!password || password.length < 6) {
                    showMessage('register-error', 'Password must be at least 6 characters long', 'error');
                    return;
                }
                
                // Check if user already exists - reload data first to be sure
                loadFromLocalStorage();
                console.log('🔍 Checking against existing users:', allUsers.length, 'users');
                
                const existingUser = allUsers.find(u => u.email.toLowerCase() === email.toLowerCase());
                if (existingUser) {
                    console.log('❌ Email already exists:', existingUser.email);
                    showMessage('register-error', 'Email already registered. Please use a different email or try logging in.', 'error');
                    return;
                }
                
                console.log('✅ Validation passed, starting registration process');
                clearMessages();
                showLoading('register-form', true);
            
            // Add a simple test mode that bypasses portfolio processing if there are issues
            const isTestMode = window.location.hash.includes('test') || localStorage.getItem('lenslink_debug_mode') === 'true';
            if (isTestMode) {
                console.log('🧪 Test mode enabled - simplified registration');
                setTimeout(() => {
                    createNewUserSimple();
                }, 300);
                return;
            }
            
            // Simulate API delay
            setTimeout(() => {
                console.log('⏰ Starting user creation process');
                
                // Handle profile photo if user is photographer
                let profileImage = `https://placehold.co/100x100/94a3b8/ffffff?text=${name.charAt(0)}`;
                
                if (role === 'photographer') {
                    console.log('📷 Processing photographer registration with profile photo');
                    const photoFile = document.getElementById('register-profile-photo').files[0];
                    if (photoFile) {
                        console.log('📸 Photo file found, processing...');
                        // Use compressed image if available, otherwise compress now
                        const photoInput = document.getElementById('register-profile-photo');
                        if (photoInput.compressedImage) {
                            console.log('✅ Using pre-compressed image');
                            profileImage = photoInput.compressedImage;
                            createNewUser(profileImage);
                            return;
                        } else {
                            console.log('🔄 Compressing image...');
                            // Compress image before storing with error handling
                            compressImage(photoFile).then(compressedDataUrl => {
                                console.log('✅ Image compression successful');
                                profileImage = compressedDataUrl;
                                createNewUser(profileImage);
                            }).catch(error => {
                                console.error('❌ Image compression failed:', error);
                                // Use default image if compression fails
                                console.log('🔄 Using default profile image');
                                createNewUser(profileImage);
                            });
                            return;
                        }
                    } else {
                        console.log('📷 No photo file, using default image');
                    }
                }
                
                console.log('👤 Creating user with profile image:', profileImage ? 'Custom' : 'Default');
                // Always call createNewUser to ensure registration completes
                createNewUser(profileImage);
            }, 300);
            
            async function createNewUser(profileImage) {
                console.log('🏗️ Creating new user:', { name, email, role }); // Debug log
                
                try {
                    const newUser = {
                        id: 'user_' + Date.now(),
                        name,
                        email,
                        password,
                        role,
                        phone,
                        profileImage
                    };
                    
                    console.log('👤 Base user created:', newUser.id);
                    
                    // Add photographer-specific data if role is photographer
                    if (role === 'photographer') {
                        console.log('📸 Adding photographer-specific data');
                        const bio = document.getElementById('register-bio').value;
                        const specialtiesSelect = document.getElementById('register-specialties');
                        const specialties = Array.from(specialtiesSelect.selectedOptions).map(option => option.value);
                        const hourlyRate = document.getElementById('register-hourly-rate').value;
                        const experience = document.getElementById('register-experience').value;
                        const location = document.getElementById('register-location').value;
                        
                        newUser.bio = bio || 'Professional photographer with passion for capturing beautiful moments.';
                        newUser.specialties = specialties.length > 0 ? specialties : ['portraits'];
                        newUser.hourlyRate = hourlyRate ? parseInt(hourlyRate) : 150;
                        newUser.experience = experience ? parseInt(experience) : 1;
                        newUser.location = location || 'Available for travel';
                        
                        // Add portfolio images with error handling
                        try {
                            newUser.portfolio = portfolioImages && portfolioImages.length > 0 
                                ? portfolioImages.map(img => ({
                                    name: img.name,
                                    data: img.compressedData,
                                    uploadDate: new Date().toISOString()
                                }))
                                : [];
                        } catch (portfolioError) {
                            console.warn('⚠️ Portfolio processing failed, continuing without portfolio:', portfolioError);
                            newUser.portfolio = [];
                        }
                        
                        console.log('📝 Photographer data added:', { 
                            bio: newUser.bio, 
                            specialties: newUser.specialties, 
                            rate: newUser.hourlyRate,
                            portfolioCount: newUser.portfolio.length
                        });
                        
                        allPhotographers.push(newUser);
                        console.log('✅ Added photographer to photographers list:', newUser.name);
                        console.log('📊 Total photographers now:', allPhotographers.length);
                    }
                    
                    // 🚀 Try to save to Railway backend first
                    try {
                        await registerUserWithBackend({
                            name: newUser.name,
                            email: newUser.email,
                            password: newUser.password,
                            role: newUser.role,
                            phone: newUser.phone
                        });
                        console.log('☁️ User registered with Railway backend');
                    } catch (backendError) {
                        console.warn('⚠️ Backend registration failed, continuing with localStorage:', backendError);
                    }
                    
                    allUsers.push(newUser);
                    console.log('✅ Added user to users list:', newUser.name);
                    console.log('📊 Total users now:', allUsers.length);
                    
                    currentUser = newUser;
                    console.log('🔐 Set current user:', currentUser.name);
                    
                    // Try to save to localStorage with fallback
                    try {
                        saveToLocalStorage();
                        console.log('💾 Saved data to localStorage');
                    } catch (storageError) {
                        console.warn('⚠️ localStorage failed, trying without portfolio images:', storageError);
                        
                        // If storage failed and user has portfolio, try saving without portfolio
                        if (newUser.portfolio && newUser.portfolio.length > 0) {
                            const originalPortfolio = newUser.portfolio;
                            newUser.portfolio = [];
                            
                            // Remove portfolio from photographer in allPhotographers too
                            const photographerIndex = allPhotographers.findIndex(p => p.id === newUser.id);
                            if (photographerIndex !== -1) {
                                allPhotographers[photographerIndex].portfolio = [];
                            }
                            
                            try {
                                saveToLocalStorage();
                                console.log('✅ Saved without portfolio images');
                                showMessage('register-error', '⚠️ Registration successful but portfolio images were too large for storage. Please upload smaller images or fewer images.', 'warning');
                                
                                // Still proceed with registration
                                setTimeout(() => {
                                    clearMessages();
                                    showMessage('register-success', 'Account created successfully! Redirecting...', 'success');
                                    proceedWithRegistration();
                                }, 2000);
                                return;
                            } catch (secondError) {
                                // Restore original portfolio and throw error
                                newUser.portfolio = originalPortfolio;
                                if (photographerIndex !== -1) {
                                    allPhotographers[photographerIndex].portfolio = originalPortfolio;
                                }
                                throw secondError;
                            }
                        } else {
                            throw storageError;
                        }
                    }
                    
                    // Clear any previous error messages before showing success
                    clearMessages();
                    showMessage('register-success', 'Account created successfully! Redirecting...', 'success');
                    console.log('🎉 Registration completed successfully!');
                    
                    proceedWithRegistration();
                    
                    function proceedWithRegistration() {
                        setTimeout(() => {
                            console.log('🔄 Starting UI update and redirect');
                            updateUI();
                            if (currentUser.role === 'photographer') {
                                console.log('🏠 Redirecting to photographer dashboard');
                                showPage('photographer-dashboard-page');
                                loadPhotographerDashboard();
                            } else {
                                console.log('🔍 Redirecting to find photographers');
                                showPage('find-photographers');
                                loadRegisteredPhotographers();
                            }
                            
                            // Force UI refresh to ensure menus are properly updated
                            setTimeout(() => {
                                updateUI();
                                console.log('🔄 UI refresh completed');
                            }, 100);
                        }, 1000);
                    }
                    
                } catch (error) {
                    console.error('❌ Registration error:', error);
                    console.error('❌ Error details:', {
                        message: error.message,
                        stack: error.stack,
                        name: error.name
                    });
                    
                    // Show more specific error message
                    let errorMessage = 'Registration failed. ';
                    if (error.message && error.message.includes('localStorage')) {
                        errorMessage += 'Storage error - please check browser settings.';
                    } else if (error.message && error.message.includes('portfolio')) {
                        errorMessage += 'Portfolio processing error - trying without images.';
                    } else {
                        errorMessage += 'Please try again or contact support.';
                    }
                    
                    showMessage('register-error', errorMessage, 'error');
                } finally {
                    console.log('🏁 Registration process finished, clearing loading state');
                    showLoading('register-form', false);
                    isRegistering = false; // Clear registration flag
                }
            }
            
            // Simplified registration for testing/debugging
            function createNewUserSimple() {
                console.log('🏗️ Creating new user (simplified mode):', { name, email, role });
                
                try {
                    const newUser = {
                        id: 'user_' + Date.now(),
                        name,
                        email,
                        password,
                        role,
                        phone,
                        profileImage: `https://placehold.co/100x100/94a3b8/ffffff?text=${name.charAt(0)}`
                    };
                    
                    console.log('👤 Base user created:', newUser.id);
                    
                    // Add photographer-specific data if role is photographer
                    if (role === 'photographer') {
                        console.log('📸 Adding basic photographer data');
                        const bio = document.getElementById('register-bio').value;
                        const specialtiesSelect = document.getElementById('register-specialties');
                        const specialties = Array.from(specialtiesSelect.selectedOptions).map(option => option.value);
                        const hourlyRate = document.getElementById('register-hourly-rate').value;
                        const experience = document.getElementById('register-experience').value;
                        const location = document.getElementById('register-location').value;
                        
                        newUser.bio = bio || 'Professional photographer with passion for capturing beautiful moments.';
                        newUser.specialties = specialties.length > 0 ? specialties : ['portraits'];
                        newUser.hourlyRate = hourlyRate ? parseInt(hourlyRate) : 150;
                        newUser.experience = experience ? parseInt(experience) : 1;
                        newUser.location = location || 'Available for travel';
                        newUser.portfolio = []; // Empty portfolio for simplified mode
                        
                        allPhotographers.push(newUser);
                        console.log('✅ Added photographer to photographers list:', newUser.name);
                    }
                    
                    allUsers.push(newUser);
                    console.log('✅ Added user to users list:', newUser.name);
                    
                    currentUser = newUser;
                    console.log('🔐 Set current user:', currentUser.name);
                    
                    saveToLocalStorage();
                    console.log('💾 Saved data to localStorage');
                    
                    // Clear any previous error messages before showing success
                    clearMessages();
                    showMessage('register-success', 'Account created successfully! Redirecting...', 'success');
                    console.log('🎉 Registration completed successfully!');
                    
                    proceedWithRegistration();
                    
                } catch (error) {
                    console.error('❌ Simplified registration error:', error);
                    showMessage('register-error', 'Registration failed: ' + error.message, 'error');
                } finally {
                    showLoading('register-form', false);
                    isRegistering = false; // Clear registration flag
                }
            }
            
            } catch (mainError) {
                console.error('❌ Main registration error:', mainError);
                showMessage('register-error', 'Registration failed. Please try again.', 'error');
            } finally {
                showLoading('register-form', false);
                isRegistering = false;
            }
        }

        function handleLogout() {
            // Clear current user
            currentUser = null;
            localStorage.removeItem(STORAGE_KEYS.currentUser);
            
            // Clear any form data
            const loginForm = document.getElementById('login-form');
            if (loginForm) {
                loginForm.reset();
                // Ensure login form is visible after logout
                loginForm.style.display = 'block';
            }
            const registerForm = document.getElementById('register-form');
            if (registerForm) {
                registerForm.reset();
                registerForm.style.display = 'none';
            }
            
            // Reset login/register tabs to login as default
            const loginTab = document.getElementById('login-tab');
            const registerTab = document.getElementById('register-tab');
            if (loginTab && registerTab) {
                loginTab.classList.add('border-orange-500', 'text-orange-500');
                loginTab.classList.remove('text-slate-500');
                registerTab.classList.remove('border-orange-500', 'text-orange-500');
                registerTab.classList.add('text-slate-500');
            }
            
            // Clear messages
            clearMessages();
            
            // Update UI
            updateUI();
            
            // Go to home page
            showPage('home');
            
            // Show success message
            setTimeout(() => {
                alert('You have been logged out successfully! You can now login again.');
            }, 100);
        }

        function handlePhotographerProfileUpdate(e) {
            e.preventDefault();
            
            if (!currentUser || currentUser.role !== 'photographer') {
                alert('Access denied. Please login as a photographer.');
                return;
            }
            
            console.log('🔄 Starting profile update...');
            
            // Get form data
            const name = document.getElementById('edit-name').value.trim();
            const bio = document.getElementById('edit-bio').value.trim();
            const location = document.getElementById('edit-location').value.trim();
            const hourlyRate = document.getElementById('edit-hourly-rate').value;
            const experience = document.getElementById('edit-experience').value;
            
            // Get selected specialties
            const specialtiesSelect = document.getElementById('edit-specialties');
            const specialties = Array.from(specialtiesSelect.selectedOptions).map(option => option.value);
            
            // Validation
            if (!name) {
                showEditMessage('profile-edit-error', 'Please enter your full name', 'error');
                return;
            }
            
            if (!bio) {
                showEditMessage('profile-edit-error', 'Please enter a bio', 'error');
                return;
            }
            
            if (specialties.length === 0) {
                showEditMessage('profile-edit-error', 'Please select at least one specialty', 'error');
                return;
            }
            
            clearEditMessages();
            
            // Show loading
            const submitBtn = document.querySelector('#photographer-profile-form button[type="submit"]');
            const originalText = submitBtn.textContent;
            submitBtn.disabled = true;
            submitBtn.textContent = 'Saving...';
            
            try {
                // Update current user data
                currentUser.name = name;
                currentUser.bio = bio;
                currentUser.location = location;
                currentUser.specialties = specialties;
                currentUser.hourlyRate = hourlyRate ? parseInt(hourlyRate) : currentUser.hourlyRate;
                currentUser.experience = experience ? parseInt(experience) : currentUser.experience;
                
                // Handle profile photo update
                const photoInput = document.getElementById('edit-profile-photo');
                if (photoInput && photoInput.compressedImage) {
                    currentUser.profileImage = photoInput.compressedImage;
                    console.log('✅ Updated profile image');
                }
                
                // Handle portfolio images update
                if (window.editPortfolioImages && window.editPortfolioImages.length > 0) {
                    // Add new portfolio images to existing ones
                    if (!currentUser.portfolio) currentUser.portfolio = [];
                    
                    const newPortfolioItems = window.editPortfolioImages.map(img => ({
                        name: img.name,
                        data: img.compressedData,
                        uploadDate: new Date().toISOString()
                    }));
                    
                    currentUser.portfolio = [...currentUser.portfolio, ...newPortfolioItems];
                    console.log('✅ Added', newPortfolioItems.length, 'new portfolio images');
                }
                
                // Update in allUsers array
                const userIndex = allUsers.findIndex(u => u.id === currentUser.id);
                if (userIndex !== -1) {
                    allUsers[userIndex] = currentUser;
                }
                
                // Update in allPhotographers array
                const photographerIndex = allPhotographers.findIndex(p => p.id === currentUser.id);
                if (photographerIndex !== -1) {
                    allPhotographers[photographerIndex] = currentUser;
                }
                
                // Save to localStorage
                saveToLocalStorage();
                
                // Update current user in localStorage
                localStorage.setItem(STORAGE_KEYS.currentUser, JSON.stringify(currentUser));
                
                console.log('✅ Profile updated successfully');
                showEditMessage('profile-edit-success', 'Profile updated successfully!', 'success');
                
                // Update UI
                updateUI();
                
                // Redirect to dashboard after a short delay
                setTimeout(() => {
                    showPage('photographer-dashboard-page');
                }, 1500);
                
            } catch (error) {
                console.error('❌ Profile update failed:', error);
                showEditMessage('profile-edit-error', 'Failed to update profile. Please try again.', 'error');
            } finally {
                // Restore button
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
            }
        }
        
        // Initialize edit profile page with current user data
        function initializeEditProfile() {
            console.log('🎨 initializeEditProfile called');
            
            if (!currentUser || currentUser.role !== 'photographer') {
                console.log('❌ Access denied - not a photographer or not logged in');
                alert('Access denied. Please login as a photographer first.');
                showPage('home');
                return;
            }
            
            console.log('🎨 Initializing edit profile page for:', currentUser.name);
            
            // Populate form fields with current data with error handling
            try {
                const nameField = document.getElementById('edit-name');
                const bioField = document.getElementById('edit-bio');
                const locationField = document.getElementById('edit-location');
                const rateField = document.getElementById('edit-hourly-rate');
                const experienceField = document.getElementById('edit-experience');
                
                if (nameField) {
                    nameField.value = currentUser.name || '';
                    console.log('✅ Set name field');
                } else {
                    console.log('❌ Name field not found');
                }
                
                if (bioField) {
                    bioField.value = currentUser.bio || '';
                    console.log('✅ Set bio field');
                } else {
                    console.log('❌ Bio field not found');
                }
                
                if (locationField) {
                    locationField.value = currentUser.location || '';
                    console.log('✅ Set location field');
                } else {
                    console.log('❌ Location field not found');
                }
                
                if (rateField) {
                    rateField.value = currentUser.hourlyRate || '';
                    console.log('✅ Set rate field');
                } else {
                    console.log('❌ Rate field not found');
                }
                
                if (experienceField) {
                    experienceField.value = currentUser.experience || '';
                    console.log('✅ Set experience field');
                } else {
                    console.log('❌ Experience field not found');
                }
            } catch (error) {
                console.error('❌ Error setting form fields:', error);
            }
            
            // Set current profile image
            const currentProfileImage = document.getElementById('current-profile-image');
            if (currentProfileImage) {
                currentProfileImage.innerHTML = `
                    <img src="${currentUser.profileImage || 'https://placehold.co/80x80/94a3b8/ffffff?text=' + currentUser.name.charAt(0)}" 
                         alt="Current profile" 
                         class="w-full h-full object-cover">
                `;
            }
            
            // Set selected specialties
            const specialtiesSelect = document.getElementById('edit-specialties');
            if (specialtiesSelect && currentUser.specialties) {
                Array.from(specialtiesSelect.options).forEach(option => {
                    option.selected = currentUser.specialties.includes(option.value);
                });
            }
            
            // Display current portfolio images
            displayCurrentPortfolioImages();
            
            // Clear any previous image selections
            document.getElementById('edit-profile-photo').value = '';
            document.getElementById('edit-portfolio-images').value = '';
            document.getElementById('edit-profile-image-preview').innerHTML = '';
            document.getElementById('edit-portfolio-preview').innerHTML = '';
            
            // Reset portfolio images array for editing
            window.editPortfolioImages = [];
            
            clearEditMessages();
        }
        
        // Manual initialization as backup
        function manuallyInitializeEditProfile() {
            console.log('🔧 Manual edit profile initialization');
            
            if (!currentUser || currentUser.role !== 'photographer') {
                console.log('❌ Manual init failed - not a photographer');
                return;
            }
            
            // Basic form population with error handling
            setTimeout(() => {
                const fields = {
                    'edit-name': currentUser.name || '',
                    'edit-bio': currentUser.bio || '',
                    'edit-location': currentUser.location || '',
                    'edit-hourly-rate': currentUser.hourlyRate || '',
                    'edit-experience': currentUser.experience || ''
                };
                
                Object.keys(fields).forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.value = fields[id];
                        console.log(`✅ Set ${id} to:`, fields[id]);
                    } else {
                        console.log(`❌ Field ${id} not found`);
                    }
                });
                
                // Set profile image
                const profileImg = document.getElementById('current-profile-image');
                if (profileImg) {
                    profileImg.innerHTML = `
                        <img src="${currentUser.profileImage || 'https://placehold.co/80x80/94a3b8/ffffff?text=' + currentUser.name.charAt(0)}" 
                             alt="Current profile" 
                             class="w-full h-full object-cover">
                    `;
                }
                
                // Set specialties
                const specialtiesSelect = document.getElementById('edit-specialties');
                if (specialtiesSelect && currentUser.specialties) {
                    Array.from(specialtiesSelect.options).forEach(option => {
                        option.selected = currentUser.specialties.includes(option.value);
                    });
                }
                
                console.log('✅ Manual initialization complete');
            }, 200);
        }
        
        // Display current portfolio images with delete functionality
        function displayCurrentPortfolioImages() {
            const container = document.getElementById('current-portfolio-images');
            if (!container) return;
            
            if (!currentUser.portfolio || currentUser.portfolio.length === 0) {
                container.innerHTML = '<p class="col-span-full text-center text-slate-500 text-sm">No portfolio images yet</p>';
                return;
            }
            
            container.innerHTML = currentUser.portfolio.map((portfolioItem, index) => {
                const imageData = portfolioItem.data || portfolioItem;
                const imageName = portfolioItem.name || `Portfolio Image ${index + 1}`;
                return `
                    <div class="relative group">
                        <img src="${imageData}" 
                             alt="${imageName}" 
                             class="w-full h-20 object-cover rounded-lg border-2 border-slate-200">
                        <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-opacity rounded-lg flex items-center justify-center">
                            <button onclick="removeCurrentPortfolioImage(${index})" 
                                    class="opacity-0 group-hover:opacity-100 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-600 transition-all">
                                ×
                            </button>
                        </div>
                        <p class="text-xs text-slate-500 mt-1 truncate">${imageName}</p>
                    </div>
                `;
            }).join('');
        }
        
        // Remove current portfolio image
        window.removeCurrentPortfolioImage = function(index) {
            if (!currentUser.portfolio || index >= currentUser.portfolio.length) return;
            
            if (confirm('Are you sure you want to remove this image from your portfolio?')) {
                currentUser.portfolio.splice(index, 1);
                
                // Update in storage arrays
                const userIndex = allUsers.findIndex(u => u.id === currentUser.id);
                if (userIndex !== -1) {
                    allUsers[userIndex].portfolio = currentUser.portfolio;
                }
                
                const photographerIndex = allPhotographers.findIndex(p => p.id === currentUser.id);
                if (photographerIndex !== -1) {
                    allPhotographers[photographerIndex].portfolio = currentUser.portfolio;
                }
                
                // Save to localStorage
                saveToLocalStorage();
                localStorage.setItem(STORAGE_KEYS.currentUser, JSON.stringify(currentUser));
                
                // Refresh display
                displayCurrentPortfolioImages();
                
                console.log('✅ Removed portfolio image at index', index);
            }
        };
        
        // Helper functions for edit profile messages
        function showEditMessage(elementId, message, type) {
            const element = document.getElementById(elementId);
            if (element) {
                element.textContent = message;
                element.className = `text-sm text-center ${type === 'error' ? 'text-red-600' : 'text-green-600'}`;
                element.classList.remove('hidden');
            }
        }
        
        function clearEditMessages() {
            const messageElements = ['profile-edit-error', 'profile-edit-success'];
            messageElements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.classList.add('hidden');
                }
            });
        }
        
        // Profile image preview for edit page
        function previewEditProfileImage(input) {
            const file = input.files[0];
            const previewContainer = document.getElementById('edit-profile-image-preview');
            
            if (!file) {
                if (previewContainer) previewContainer.innerHTML = '';
                input.compressedImage = null;
                return;
            }
            
            // Validate file
            const validation = validateImageFile(file);
            if (!validation.valid) {
                alert(validation.error);
                input.value = '';
                if (previewContainer) previewContainer.innerHTML = '';
                return;
            }
            
            // Show loading indicator
            if (previewContainer) {
                previewContainer.innerHTML = `
                    <div class="text-center py-4">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500 mx-auto"></div>
                        <p class="text-sm text-slate-600 mt-2">Processing new profile image...</p>
                    </div>
                `;
            }
            
            // Compress and preview image
            compressImage(file).then(compressedDataUrl => {
                if (previewContainer) {
                    const originalSize = (file.size / 1024).toFixed(1);
                    const compressedSize = (compressedDataUrl.length * 0.75 / 1024).toFixed(1);
                    
                    previewContainer.innerHTML = `
                        <div class="flex items-center space-x-4 p-3 bg-green-50 border border-green-200 rounded-lg">
                            <img src="${compressedDataUrl}" 
                                 alt="New profile preview" 
                                 class="w-16 h-16 rounded-full object-cover border-2 border-green-300">
                            <div>
                                <p class="text-sm text-green-700 font-medium">✅ New profile image ready</p>
                                <p class="text-xs text-green-600">Optimized: ${originalSize}KB → ${compressedSize}KB</p>
                            </div>
                        </div>
                    `;
                }
                
                // Store compressed image
                input.compressedImage = compressedDataUrl;
            }).catch(error => {
                console.error('Profile image processing failed:', error);
                if (previewContainer) {
                    previewContainer.innerHTML = `
                        <div class="text-center py-4">
                            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                                <p class="text-sm text-yellow-700">⚠️ Image processing failed</p>
                                <p class="text-xs text-yellow-600 mt-1">Please try a different image</p>
                            </div>
                        </div>
                    `;
                }
                input.compressedImage = null;
            });
        }
        
        // Portfolio images preview for edit page
        window.editPortfolioImages = [];
        
        function previewEditPortfolioImages(input) {
            const files = Array.from(input.files);
            const previewContainer = document.getElementById('edit-portfolio-preview');
            
            if (!files.length) {
                if (previewContainer) previewContainer.innerHTML = '';
                window.editPortfolioImages = [];
                return;
            }
            
            // Limit total portfolio images to 20
            const currentCount = currentUser.portfolio ? currentUser.portfolio.length : 0;
            const newCount = files.length;
            const totalCount = currentCount + newCount;
            
            if (totalCount > 20) {
                alert(`You can have maximum 20 portfolio images total. You currently have ${currentCount} images. Please select maximum ${20 - currentCount} new images.`);
                input.value = '';
                return;
            }
            
            // Validate all files
            for (let file of files) {
                const validation = validateImageFile(file);
                if (!validation.valid) {
                    alert(`Error with "${file.name}": ${validation.error}`);
                    input.value = '';
                    if (previewContainer) previewContainer.innerHTML = '';
                    return;
                }
            }
            
            // Show loading indicator
            if (previewContainer) {
                previewContainer.innerHTML = `
                    <div class="col-span-full text-center py-4">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500 mx-auto"></div>
                        <p class="text-sm text-slate-600 mt-2">Processing ${files.length} new portfolio images...</p>
                    </div>
                `;
            }
            
            // Process all images
            window.editPortfolioImages = [];
            let processedCount = 0;
            
            files.forEach((file, index) => {
                compressImage(file).then(compressedDataUrl => {
                    window.editPortfolioImages.push({
                        name: file.name,
                        originalSize: file.size,
                        compressedData: compressedDataUrl,
                        index: index
                    });
                    
                    processedCount++;
                    
                    // Update preview once all images are processed
                    if (processedCount === files.length) {
                        updateEditPortfolioPreview();
                    }
                }).catch(error => {
                    console.error(`Failed to process ${file.name}:`, error);
                    processedCount++;
                    
                    if (processedCount === files.length) {
                        updateEditPortfolioPreview();
                    }
                });
            });
        }
        
        function updateEditPortfolioPreview() {
            const previewContainer = document.getElementById('edit-portfolio-preview');
            if (!previewContainer) return;
            
            if (window.editPortfolioImages.length === 0) {
                previewContainer.innerHTML = '<p class="col-span-full text-center text-slate-500">No new images to add</p>';
                return;
            }
            
            previewContainer.innerHTML = `
                <div class="col-span-full mb-2 p-2 bg-blue-50 border border-blue-200 rounded-lg">
                    <p class="text-sm text-blue-700 font-medium">
                        ✅ ${window.editPortfolioImages.length} new images ready to add
                    </p>
                </div>
                ${window.editPortfolioImages.map((img, index) => `
                    <div class="relative group">
                        <img src="${img.compressedData}" 
                             alt="New portfolio ${index + 1}" 
                             class="w-full h-20 object-cover rounded-lg border-2 border-blue-200">
                        <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-opacity rounded-lg flex items-center justify-center">
                            <button onclick="removeEditPortfolioImage(${index})" 
                                    class="opacity-0 group-hover:opacity-100 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-600 transition-all">
                                ×
                            </button>
                        </div>
                        <p class="text-xs text-slate-500 mt-1 truncate">${img.name}</p>
                    </div>
                `).join('')}
            `;
        }
        
        function removeEditPortfolioImage(index) {
            window.editPortfolioImages.splice(index, 1);
            updateEditPortfolioPreview();
        }
        
        // Make functions globally accessible for edit profile
        window.previewEditProfileImage = previewEditProfileImage;
        window.previewEditPortfolioImages = previewEditPortfolioImages;
        window.removeEditPortfolioImage = removeEditPortfolioImage;
        
        // Debug test function for edit profile - Make globally accessible
        window.testEditProfile = function() {
            console.log('🔧 TEST: Edit profile button clicked');
            console.log('🔧 TEST: Current user:', currentUser);
            console.log('🔧 TEST: User role:', currentUser?.role);
            
            if (!currentUser) {
                alert('❌ TEST: No user logged in!');
                return;
            }
            
            if (currentUser.role !== 'photographer') {
                alert('❌ TEST: User is not a photographer! Role: ' + currentUser.role);
                return;
            }
            
            console.log('🔧 TEST: Trying to show edit profile page...');
            
            // Hide all pages
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => {
                page.classList.remove('active');
                console.log('🔧 TEST: Hiding page:', page.id);
            });
            
            // Show edit profile page
            const editPage = document.getElementById('photographer-profile-edit');
            if (editPage) {
                editPage.classList.add('active');
                console.log('✅ TEST: Edit profile page found and activated');
                
                // Try to populate one field as test
                setTimeout(() => {
                    const nameField = document.getElementById('edit-name');
                    if (nameField) {
                        nameField.value = currentUser.name || 'Test Name';
                        console.log('✅ TEST: Name field populated');
                        alert('✅ TEST SUCCESS: Edit profile page is working! Check the form.');
                    } else {
                        console.log('❌ TEST: Name field not found');
                        alert('❌ TEST: Page loaded but form fields not found');
                    }
                }, 100);
            } else {
                console.log('❌ TEST: Edit profile page not found');
                alert('❌ TEST: Edit profile page element not found in DOM');
            }
        }

        // --- UI Functions ---
        function updateUI() {
            if (currentUser) {
                // Show user menu, hide auth buttons
                if (authButtons) authButtons.classList.add('hidden');
                if (userMenu) userMenu.classList.remove('hidden');
                
                // Update user info
                if (userWelcome) userWelcome.textContent = `Welcome, ${currentUser.name}`;
                if (userName) userName.textContent = currentUser.name;
                if (userAvatar) userAvatar.src = currentUser.profileImage || 'https://placehold.co/32x32/94a3b8/ffffff?text=' + currentUser.name.charAt(0);
                
                // Update navigation based on role
                updateNavigationForRole();
                
                // Show photographer menu items if user is a photographer
                if (currentUser.role === 'photographer') {
                    if (photographerMenu) photographerMenu.classList.remove('hidden');
                    const findPhotographersLink = document.getElementById('find-photographers-link');
                    if (findPhotographersLink) findPhotographersLink.classList.add('hidden');
                } else {
                    if (photographerMenu) photographerMenu.classList.add('hidden');
                    const findPhotographersLink = document.getElementById('find-photographers-link');
                    if (findPhotographersLink) findPhotographersLink.classList.remove('hidden');
                }
            } else {
                // Show auth buttons, hide user menu
                if (authButtons) authButtons.classList.remove('hidden');
                if (userMenu) userMenu.classList.add('hidden');
                if (photographerMenu) photographerMenu.classList.add('hidden');
                // Reset navigation to default
                resetNavigation();
            }
        }

        function updateNavigationForRole() {
            const navLinks = document.querySelectorAll('.nav-link');
            const photographersLink = document.querySelector('.nav-link[data-page="photographers"]');
            const myBookingsLink = document.getElementById('my-bookings');
            
            if (currentUser && currentUser.role === 'client') {
                // For clients, hide "Find a Photographer" and hide "My Bookings" completely
                if (photographersLink) {
                    photographersLink.style.display = 'none';
                }
                if (myBookingsLink) {
                    myBookingsLink.style.display = 'none';
                }
            } else if (currentUser && currentUser.role === 'photographer') {
                // For photographers, keep navigation normal but change "My Bookings" to "My Bookings"
                if (photographersLink) {
                    photographersLink.style.display = 'block';
                }
                if (myBookingsLink) {
                    myBookingsLink.style.display = 'block';
                    myBookingsLink.textContent = 'My Bookings';
                }
            }
        }

        function resetNavigation() {
            const navLinks = document.querySelectorAll('.nav-link');
            const photographersLink = document.querySelector('.nav-link[data-page="photographers"]');
            const myBookingsLink = document.getElementById('my-bookings');
            
            // Reset to default navigation
            if (photographersLink) {
                photographersLink.style.display = 'block';
            }
            if (myBookingsLink) {
                myBookingsLink.textContent = 'My Bookings';
            }
        }

        function showMessage(elementId, message, type) {
            const element = document.getElementById(elementId);
            if (element) {
                // If trying to show success but there's already an error visible, don't show success
                if (type === 'success' && elementId.includes('register')) {
                    const errorElement = document.getElementById('register-error');
                    if (errorElement && !errorElement.classList.contains('hidden')) {
                        console.log('⚠️ Skipping success message because error is visible');
                        return;
                    }
                }
                
                element.textContent = message;
                element.className = `text-sm text-center ${type === 'error' || type === 'warning' ? 'text-red-600' : 'text-green-600'}`;
                element.classList.remove('hidden');
                
                console.log(`📢 Message shown (${type}):`, message);
            }
        }

        function clearMessages() {
            const messageElements = ['login-error', 'login-success', 'register-error', 'register-success'];
            messageElements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.classList.add('hidden');
                }
            });
        }

        function showLoading(formId, isLoading) {
            const form = document.getElementById(formId);
            const submitButton = form.querySelector('button[type="submit"]');
            
            if (isLoading) {
                submitButton.disabled = true;
                submitButton.textContent = 'Loading...';
            } else {
                submitButton.disabled = false;
                submitButton.textContent = formId === 'login-form' ? 'Log In' : 'Create Account';
            }
        }

        // --- Initialization ---
        async function initializeApp() {
            // Ensure all data is loaded
            loadFromLocalStorage();
            
            // Initialize booking form
            initializeBookingForm();
            
            // Update UI based on current user state
            if (currentUser) {
                updateUI();
            } else {
                updateUI();
            }
        }

        // --- Photographers Functions (Local Storage) ---
        async function loadPhotographers() {
            displayPhotographers(allPhotographers);
        }

        function displayPhotographers(photographers) {
            const container = document.querySelector('#photographers .grid');
            if (!container) return;

            container.innerHTML = photographers.map(photographer => `
                <div class="bg-white rounded-lg shadow-md overflow-hidden transform hover:-translate-y-2 transition-transform duration-300">
                    <img src="${photographer.profileImage}" 
                         alt="Photographer ${photographer.name}" class="w-full h-48 object-cover">
                    <div class="p-6">
                        <h3 class="text-xl font-bold">${photographer.name}</h3>
                        <p class="text-slate-600 mb-2">${photographer.specialties ? photographer.specialties.join(', ') : 'Professional Photographer'}</p>
                        <p class="text-sm text-slate-500 mb-4">$${photographer.hourlyRate || 150}/hour</p>
                        <button onclick="viewPhotographerProfile('${photographer.id}')" 
                                class="w-full text-center bg-orange-500 text-white font-semibold py-2 px-4 rounded-md hover:bg-orange-600 transition-colors">
                            View Profile & Book
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function viewPhotographerProfile(photographerId) {
            const photographer = allPhotographers.find(p => p.id === photographerId);
            if (photographer) {
                window.selectedPhotographer = photographer;
                showPage('profile');
                displayPhotographerProfile(photographer);
            }
        }

        function displayPhotographerProfile(photographer) {
            const profilePage = document.getElementById('profile');
            if (!profilePage) return;

            profilePage.innerHTML = `
                <div class="bg-white p-8 rounded-lg shadow-lg">
                    <div class="flex flex-col md:flex-row gap-8">
                        <div class="md:w-1/3 text-center md:text-left">
                            <img src="${photographer.profileImage}" 
                                 alt="Photographer ${photographer.name}" class="w-48 h-48 rounded-full mx-auto md:mx-0 object-cover shadow-md">
                            <h1 class="text-3xl font-bold font-serif-display mt-4">${photographer.name}</h1>
                            <p class="text-slate-600 text-lg">${photographer.specialties ? photographer.specialties.join(', ') : 'Professional Photographer'}</p>
                            <p class="mt-4 text-slate-700">${photographer.bio || 'Capturing beautiful moments with passion and creativity.'}</p>
                            <div class="mt-4">
                                <p class="text-lg font-semibold">$${photographer.hourlyRate || 150}/hour</p>
                                <p class="text-sm text-slate-600">${photographer.experience || 5}+ years experience</p>
                                <p class="text-sm text-slate-600">${photographer.location || 'Available for travel'}</p>
                            </div>
                        </div>
                        <div class="md:w-2/3">
                            <h2 class="text-2xl font-bold mb-4 border-b pb-2">Book Photography Session</h2>
                            ${currentUser ? `
                                <div class="grid md:grid-cols-2 gap-6">
                                    <!-- Booking Calendar -->
                                    <div class="bg-slate-50 p-6 rounded-lg">
                                        <h3 class="text-lg font-semibold mb-4">Select Date & Time</h3>
                                        <div id="booking-calendar" class="mb-4"></div>
                                        <button onclick="openBookingModal('${photographer.id}')" 
                                                class="w-full bg-orange-500 text-white px-6 py-3 rounded-md hover:bg-orange-600 font-semibold">
                                            Book Photography Session
                                        </button>
                                    </div>
                                    
                                    <!-- Contact Details -->
                                    <div class="bg-white border-2 border-slate-200 p-6 rounded-lg">
                                        <h3 class="text-lg font-semibold mb-4">Contact Information</h3>
                                        <div class="space-y-3">
                                            <div class="flex items-center gap-3">
                                                <svg class="w-5 h-5 text-slate-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 7.89a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                                </svg>
                                                <span class="text-slate-700">${photographer.email}</span>
                                            </div>
                                            <div class="flex items-center gap-3">
                                                <svg class="w-5 h-5 text-slate-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
                                                </svg>
                                                <span class="text-slate-700">${photographer.phone || '+1 (555) 123-4567'}</span>
                                            </div>
                                            <div class="flex items-center gap-3">
                                                <svg class="w-5 h-5 text-slate-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                                </svg>
                                                <span class="text-slate-700">${photographer.location || 'Available for travel'}</span>
                                            </div>
                                        </div>
                                        <div class="mt-4 p-3 bg-orange-50 rounded-lg">
                                            <p class="text-sm text-orange-800">
                                                <strong>Booking Rate:</strong> $${photographer.hourlyRate || 150}/hour
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            ` : `
                                <div class="bg-slate-50 p-6 rounded-lg">
                                    <p class="text-slate-600 mb-4">Please log in to book a session with ${photographer.name}.</p>
                                    <button onclick="showPage('login')" 
                                            class="bg-orange-500 text-white px-6 py-3 rounded-md hover:bg-orange-600">
                                        Log In to Book
                                    </button>
                                </div>
                            `}
                        </div>
                    </div>
                    
                    <div class="mt-12">
                        <h2 class="text-2xl font-bold mb-4 border-b pb-2">Portfolio</h2>
                        ${photographer.portfolio && photographer.portfolio.length > 0 ? `
                            <div class="mb-4 flex items-center justify-between">
                                <p class="text-slate-600">${photographer.portfolio.length} portfolio images</p>
                                <button onclick="viewPhotographerPortfolioPDF('${photographer.id}')" 
                                        class="bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 text-sm">
                                    📄 View Portfolio PDF
                                </button>
                            </div>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                ${photographer.portfolio.map((item, index) => `
                                    <div class="relative group">
                                        <img src="${item.data || item}" 
                                             class="rounded-lg object-cover w-full h-32 cursor-pointer hover:opacity-80 transition-opacity" 
                                             alt="Portfolio image ${index + 1}"
                                             onclick="openPortfolioModal('${photographer.id}', ${index})">
                                        <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-opacity rounded-lg flex items-center justify-center">
                                            <span class="opacity-0 group-hover:opacity-100 text-white text-sm">View Larger</span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : `
                            <div class="text-center py-8 bg-slate-50 rounded-lg">
                                <p class="text-slate-500 mb-4">Portfolio images coming soon</p>
                                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 opacity-50">
                                    <img src="https://placehold.co/600x400/fefce8/a16207?text=Sample+1" class="rounded-lg object-cover w-full h-32" alt="Sample portfolio 1">
                                    <img src="https://placehold.co/600x400/ecfccb/4d7c0f?text=Sample+2" class="rounded-lg object-cover w-full h-32" alt="Sample portfolio 2">
                                    <img src="https://placehold.co/600x400/f0f9ff/0ea5e9?text=Sample+3" class="rounded-lg object-cover w-full h-32" alt="Sample portfolio 3">
                                    <img src="https://placehold.co/600x400/fef2f2/be123c?text=Sample+4" class="rounded-lg object-cover w-full h-32" alt="Sample portfolio 4">
                                </div>
                            </div>
                        `}
                    </div>
                </div>
            `;
        }

        // Booking Modal Functions
        function openBookingModal(photographerId) {
            const modal = document.getElementById('booking-modal');
            const today = new Date().toISOString().split('T')[0];
            const selectedDateInput = document.getElementById('selected-date');
            if (selectedDateInput) {
                selectedDateInput.value = today;
            }
            
            // Store photographer ID for booking
            window.currentBookingPhotographer = photographerId;
            
            modal.classList.remove('hidden');
            
            // Initialize enhanced calendar with 3 years range
            initializeEnhancedBookingCalendar();
            
            // Initialize time selection
            initializeTimeSelection();
        }

        // Make globally accessible
        window.closeBookingModal = function() {
            const modal = document.getElementById('booking-modal');
            modal.classList.add('hidden');
        }

        function initializeEnhancedBookingCalendar() {
            const calendarDiv = document.getElementById('booking-calendar');
            if (!calendarDiv) return;
            
            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
            
            // Create calendar with month navigation for 3 years
            let selectedMonth = currentMonth;
            let selectedYear = currentYear;
            
            function renderCalendar(month, year) {
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month + 1, 0);
                const daysInMonth = lastDay.getDate();
                const startingDay = firstDay.getDay();
                
                const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                    'July', 'August', 'September', 'October', 'November', 'December'];
                
                let calendarHTML = `
                    <div class="calendar-header mb-4">
                        <div class="flex justify-between items-center mb-4">
                            <button type="button" onclick="changeMonth(-1)" class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300">&lt;</button>
                            <h3 class="font-semibold text-lg">${monthNames[month]} ${year}</h3>
                            <button type="button" onclick="changeMonth(1)" class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300">&gt;</button>
                        </div>
                        <div class="grid grid-cols-7 gap-1 text-center text-sm font-semibold text-slate-600 mb-2">
                            <div class="p-2">Sun</div>
                            <div class="p-2">Mon</div>
                            <div class="p-2">Tue</div>
                            <div class="p-2">Wed</div>
                            <div class="p-2">Thu</div>
                            <div class="p-2">Fri</div>
                            <div class="p-2">Sat</div>
                        </div>
                        <div class="grid grid-cols-7 gap-1 text-center text-sm">
                `;
                
                // Add empty cells for days before the first day of the month
                for (let i = 0; i < startingDay; i++) {
                    calendarHTML += '<div class="p-2"></div>';
                }
                
                // Add days of the month
                for (let day = 1; day <= daysInMonth; day++) {
                    const date = new Date(year, month, day);
                    const dateStr = date.toISOString().split('T')[0];
                    const isPast = date < today.setHours(0, 0, 0, 0);
                    const isToday = date.toDateString() === new Date().toDateString();
                    
                    let buttonClass = 'p-2 w-8 h-8 rounded hover:bg-orange-100 transition-colors';
                    if (isPast) {
                        buttonClass += ' text-gray-400 cursor-not-allowed';
                    } else {
                        buttonClass += ' cursor-pointer hover:bg-orange-200';
                    }
                    if (isToday) {
                        buttonClass += ' bg-orange-100 font-bold';
                    }
                    
                    calendarHTML += `
                        <button type="button" 
                                onclick="selectBookingDate('${dateStr}')" 
                                class="${buttonClass}"
                                ${isPast ? 'disabled' : ''}>
                            ${day}
                        </button>
                    `;
                }
                
                calendarHTML += '</div></div>';
                calendarDiv.innerHTML = calendarHTML;
            }
            
            // Make changeMonth function globally available
            window.changeMonth = function(direction) {
                selectedMonth += direction;
                if (selectedMonth > 11) {
                    selectedMonth = 0;
                    selectedYear++;
                } else if (selectedMonth < 0) {
                    selectedMonth = 11;
                    selectedYear--;
                }
                
                // Limit to 3 years from current year
                if (selectedYear > currentYear + 3) {
                    selectedYear = currentYear + 3;
                    selectedMonth = 11;
                } else if (selectedYear < currentYear) {
                    selectedYear = currentYear;
                    selectedMonth = currentMonth;
                }
                
                renderCalendar(selectedMonth, selectedYear);
            };
            
            renderCalendar(selectedMonth, selectedYear);
        }
        
        function initializeTimeSelection() {
            const timeContainer = document.getElementById('time-selection');
            if (!timeContainer) return;
            
            let timeHTML = `
                <div class="time-selection mb-4">
                    <h4 class="font-semibold mb-3">Select Time</h4>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">Time Format</label>
                            <select id="time-format" class="w-full p-2 border rounded" onchange="updateTimeOptions()">
                                <option value="12">12 Hour (AM/PM)</option>
                                <option value="24">24 Hour</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">Select Time</label>
                            <select id="selected-time" class="w-full p-2 border rounded">
                            </select>
                        </div>
                    </div>
                </div>
            `;
            
            timeContainer.innerHTML = timeHTML;
            updateTimeOptions();
        }
        
        window.updateTimeOptions = function() {
            const formatSelect = document.getElementById('time-format');
            const timeSelect = document.getElementById('selected-time');
            const format = formatSelect.value;
            
            let timeOptions = '';
            
            if (format === '12') {
                // 12-hour format with AM/PM
                for (let hour = 6; hour <= 11; hour++) {
                    for (let min of ['00', '30']) {
                        timeOptions += `<option value="${hour}:${min}:00">${hour}:${min} AM</option>`;
                    }
                }
                for (let hour = 12; hour <= 12; hour++) {
                    for (let min of ['00', '30']) {
                        timeOptions += `<option value="${hour}:${min}:00">${hour}:${min} PM</option>`;
                    }
                }
                for (let hour = 1; hour <= 9; hour++) {
                    for (let min of ['00', '30']) {
                        timeOptions += `<option value="${hour + 12}:${min}:00">${hour}:${min} PM</option>`;
                    }
                }
            } else {
                // 24-hour format
                for (let hour = 6; hour <= 21; hour++) {
                    for (let min of ['00', '30']) {
                        const hourStr = hour.toString().padStart(2, '0');
                        timeOptions += `<option value="${hourStr}:${min}:00">${hourStr}:${min}</option>`;
                    }
                }
            }
            
            timeSelect.innerHTML = timeOptions;
        };

        function selectBookingDate(dateStr) {
            const selectedDateInput = document.getElementById('selected-date');
            if (selectedDateInput) {
                selectedDateInput.value = dateStr;
            }
            
            // Update calendar visual selection
            const buttons = document.querySelectorAll('#booking-calendar button');
            buttons.forEach(btn => {
                btn.classList.remove('bg-orange-500', 'text-white');
                if (!btn.disabled) {
                    btn.classList.add('bg-slate-50');
                }
            });
            
            // Highlight selected date
            event.target.classList.remove('bg-slate-50');
            event.target.classList.add('bg-orange-500', 'text-white');
        }

        // Handle booking form submission
        function initializeBookingForm() {
            const bookingForm = document.getElementById('booking-form');
            if (bookingForm) {
                bookingForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const date = document.getElementById('selected-date').value;
                    const time = document.getElementById('selected-time').value;
                    const sessionType = document.getElementById('session-type').value;
                    const duration = document.getElementById('session-duration').value;
                    const requirements = document.getElementById('special-requirements').value;
                    
                    const photographer = allPhotographers.find(p => p.id === window.currentBookingPhotographer);
                    
                    if (photographer && currentUser && date && time) {
                        // Create booking object
                        const booking = {
                            id: 'booking_' + Date.now(),
                            photographerId: photographer.id,
                            photographerName: photographer.name,
                            photographerEmail: photographer.email,
                            clientId: currentUser.id,
                            clientName: currentUser.name,
                            clientEmail: currentUser.email,
                            clientPhone: currentUser.phone || '',
                            clientProfileImage: currentUser.profileImage,
                            date: date,
                            time: time,
                            sessionType: sessionType,
                            duration: duration,
                            requirements: requirements,
                            status: 'pending',
                            createdAt: new Date().toISOString(),
                            totalCost: photographer.hourlyRate * parseInt(duration)
                        };
                        
                        // Store booking in localStorage
                        let allBookings = JSON.parse(localStorage.getItem('lenslink_bookings') || '[]');
                        allBookings.push(booking);
                        localStorage.setItem('lenslink_bookings', JSON.stringify(allBookings));
                        
                        // Show success message with booking confirmation
                        showBookingConfirmation(booking, photographer);
                        closeBookingModal();
                    } else {
                        alert('Please fill in all required fields including date and time.');
                    }
                });
            }
        }
        
        function showBookingConfirmation(booking, photographer) {
            const formatTime = (time) => {
                const [hour, minute] = time.split(':');
                const h = parseInt(hour);
                if (h === 0) return `12:${minute} AM`;
                if (h < 12) return `${h}:${minute} AM`;
                if (h === 12) return `12:${minute} PM`;
                return `${h - 12}:${minute} PM`;
            };
            
            const formatDate = (dateStr) => {
                const date = new Date(dateStr);
                return date.toLocaleDateString('en-US', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
            };
            
            const message = `
🎉 Booking Completed Successfully! 🎉

Thank you for choosing LensLink!

Booking Details:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📸 Photographer: ${photographer.name}
📧 Contact: ${photographer.email}
📅 Date: ${formatDate(booking.date)}
🕒 Time: ${formatTime(booking.time)}
📷 Session: ${booking.sessionType}
⏱️ Duration: ${booking.duration} hours
💰 Total Cost: $${booking.totalCost}
📝 Booking ID: ${booking.id}

${photographer.name} will contact you at ${currentUser.email} to confirm the details and discuss the session requirements.

Thank you for your booking! ✨
            `;
            
            alert(message);
        }

        // User Profile Functions
        function displayUserProfile() {
            const profileContent = document.getElementById('user-profile-content');
            if (!profileContent) {
                console.log('Profile content element not found');
                return;
            }
            
            if (!currentUser) {
                console.log('No current user found');
                profileContent.innerHTML = '<p class="text-red-600">Please log in to view your profile.</p>';
                return;
            }
            
            console.log('Displaying profile for user:', currentUser.name);
            
            profileContent.innerHTML = `
                <div class="text-center">
                    <img src="${currentUser.profileImage || 'https://placehold.co/400x400/a78bfa/ffffff?text=' + (currentUser.name ? currentUser.name.charAt(0) : 'U')}" 
                         alt="${currentUser.name}" 
                         class="w-32 h-32 rounded-full mx-auto mb-4 object-cover shadow-lg">
                    <h2 class="text-2xl font-bold">${currentUser.name}</h2>
                    <p class="text-slate-600 capitalize">${currentUser.role}</p>
                </div>
                
                <div class="space-y-6">
                    <div>
                        <h3 class="text-lg font-semibold mb-4">Account Information</h3>
                        <div class="bg-slate-50 p-4 rounded-lg space-y-3">
                            <div class="flex justify-between">
                                <span class="text-slate-600">Name:</span>
                                <span class="font-medium">${currentUser.name}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-slate-600">Email:</span>
                                <span class="font-medium">${currentUser.email}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-slate-600">Phone:</span>
                                <span class="font-medium">${currentUser.phone || 'Not provided'}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-slate-600">Account Type:</span>
                                <span class="font-medium capitalize">${currentUser.role}</span>
                            </div>
                            ${currentUser.role === 'photographer' ? `
                                <div class="flex justify-between">
                                    <span class="text-slate-600">Specialties:</span>
                                    <span class="font-medium">${currentUser.specialties ? currentUser.specialties.join(', ') : 'Not specified'}</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-slate-600">Experience:</span>
                                    <span class="font-medium">${currentUser.experience || 0} years</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-slate-600">Rate:</span>
                                    <span class="font-medium">$${currentUser.hourlyRate || 150}/hour</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-slate-600">Location:</span>
                                    <span class="font-medium">${currentUser.location || 'Not specified'}</span>
                                </div>
                            ` : ''}
                        </div>
                        
                        <div class="mt-6 flex gap-3">
                            <button onclick="editProfile()" class="flex-1 bg-orange-500 text-white py-2 px-4 rounded-md hover:bg-orange-600">
                                Edit Profile
                            </button>
                            ${currentUser.role === 'photographer' ? `
                                <button onclick="showPage('photographer-dashboard-page')" class="flex-1 bg-slate-500 text-white py-2 px-4 rounded-md hover:bg-slate-600">
                                    Go to Dashboard
                                </button>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        function editProfile() {
            alert('Profile editing functionality would be implemented here. This is a demo version.');
        }

        // Initialize login page to ensure forms are working
        function initializeLoginPage() {
            const loginForm = document.getElementById('login-form');
            const registerForm = document.getElementById('register-form');
            const loginTab = document.getElementById('login-tab');
            const registerTab = document.getElementById('register-tab');
            
            // Ensure login form is visible and register form is hidden
            if (loginForm && registerForm) {
                loginForm.style.display = 'block';
                registerForm.style.display = 'none';
            }
            
            // Ensure login tab is active
            if (loginTab && registerTab) {
                loginTab.classList.add('border-orange-500', 'text-orange-500');
                loginTab.classList.remove('text-slate-500');
                registerTab.classList.remove('border-orange-500', 'text-orange-500');
                registerTab.classList.add('text-slate-500');
            }
            
            // Clear any messages
            clearMessages();
            
            // Re-attach event listeners to ensure they work
            if (loginForm) {
                loginForm.removeEventListener('submit', handleLogin);
                loginForm.addEventListener('submit', handleLogin);
            }
            if (registerForm) {
                registerForm.removeEventListener('submit', handleRegister);
                registerForm.addEventListener('submit', handleRegister);
            }
            
            console.log('Login page initialized'); // Debug log
        }

        // Load registered photographers
        function loadRegisteredPhotographers() {
            displayRegisteredPhotographers(allPhotographers);
        }

        function displayRegisteredPhotographers(photographers) {
            const grid = document.getElementById('registered-photographers-grid');
            if (!grid) return;

            if (!photographers || photographers.length === 0) {
                grid.innerHTML = '<div class="text-center py-8 col-span-full"><p class="text-slate-500">No photographers found. Be the first to register as a photographer!</p></div>';
                return;
            }

            grid.innerHTML = photographers.map(photographer => {
                return `
                    <div class="bg-white rounded-lg shadow-md overflow-hidden transform hover:-translate-y-2 transition-transform duration-300">
                        <img src="${photographer.profileImage}" 
                             alt="Photographer ${photographer.name}" 
                             class="w-full h-48 object-cover">
                        <div class="p-6">
                            <h3 class="text-xl font-bold">${photographer.name}</h3>
                            <p class="text-slate-600 mb-2">${photographer.specialties ? photographer.specialties.join(', ') : 'Photography Services'}</p>
                            <p class="text-slate-500 text-sm mb-3">${photographer.location || 'Location not specified'}</p>
                            <p class="text-orange-600 font-semibold mb-4">$${photographer.hourlyRate || 150}/hour</p>
                            <button onclick="viewPhotographerProfile('${photographer.id}')" 
                                    class="w-full text-center bg-orange-500 text-white font-semibold py-2 px-4 rounded-md hover:bg-orange-600 transition-colors">
                                View Profile & Book
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Make function globally accessible
        window.searchRegisteredPhotographers = function() {
            const searchTerm = document.getElementById('photographer-search').value.toLowerCase();
            const specialty = document.getElementById('specialty-filter').value;

            const filtered = allPhotographers.filter(photographer => {
                const nameMatch = !searchTerm || photographer.name.toLowerCase().includes(searchTerm);
                const specialtyMatch = !specialty || (photographer.specialties && photographer.specialties.includes(specialty));
                
                return nameMatch && specialtyMatch;
            });

            displayRegisteredPhotographers(filtered);
        }

        // Search photographers with filters - Make globally accessible
        window.searchPhotographers = function() {
            const searchTerm = document.getElementById('search-photographer').value.toLowerCase();
            const specialty = document.getElementById('filter-specialty').value;
            const location = document.getElementById('filter-location').value.toLowerCase();
            
            const filtered = allPhotographers.filter(photographer => {
                const nameMatch = !searchTerm || photographer.name.toLowerCase().includes(searchTerm);
                const specialtyMatch = !specialty || (photographer.specialties && photographer.specialties.includes(specialty));
                const locationMatch = !location || (photographer.location && photographer.location.toLowerCase().includes(location));
                
                return nameMatch && specialtyMatch && locationMatch;
            });

            displayPhotographersInBookingPage(filtered);
        }

        function displayPhotographersInBookingPage(photographers) {
            const container = document.getElementById('photographer-results');
            if (!container) return;

            if (photographers.length === 0) {
                container.innerHTML = '<div class="col-span-full text-center py-8"><p class="text-slate-600">No photographers found matching your criteria.</p></div>';
                return;
            }

            container.innerHTML = photographers.map(photographer => `
                <div class="bg-white rounded-lg shadow-md overflow-hidden transform hover:-translate-y-2 transition-transform duration-300">
                    <img src="${photographer.profileImage}" 
                         alt="Photographer ${photographer.name}" class="w-full h-48 object-cover">
                    <div class="p-6">
                        <h3 class="text-xl font-bold">${photographer.name}</h3>
                        <p class="text-slate-600 mb-2">${photographer.specialties ? photographer.specialties.join(', ') : 'Professional Photographer'}</p>
                        <p class="text-sm text-slate-500 mb-2">${photographer.location || 'Available for travel'}</p>
                        <p class="text-sm font-semibold text-orange-600 mb-2">$${photographer.hourlyRate || 150}/hour</p>
                        ${photographer.portfolio && photographer.portfolio.length > 0 ? 
                            `<p class="text-xs text-green-600 mb-3">📸 ${photographer.portfolio.length} portfolio images available</p>` : 
                            `<p class="text-xs text-slate-400 mb-3">📸 Portfolio coming soon</p>`
                        }
                        <button onclick="viewPhotographerProfile('${photographer.id}')" 
                                class="w-full text-center bg-orange-500 text-white font-semibold py-2 px-4 rounded-md hover:bg-orange-600 transition-colors">
                            View Profile & Book
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Load photographer dashboard
        function loadPhotographerDashboard() {
            if (!currentUser || currentUser.role !== 'photographer') {
                console.log('User not found or not a photographer:', currentUser);
                return;
            }
            
            console.log('Loading photographer dashboard for:', currentUser.name);
            displayPhotographerDashboard(currentUser);
        }

        function displayPhotographerDashboard(photographer) {
            console.log('Displaying dashboard for photographer:', photographer);
            
            const profileInfo = document.getElementById('dashboard-profile-info');
            if (profileInfo) {
                profileInfo.innerHTML = `
                    <div class="text-center">
                        <img src="${photographer.profileImage || 'https://placehold.co/400x400/a78bfa/ffffff?text=' + (photographer.name ? photographer.name.charAt(0) : 'P')}" 
                             alt="${photographer.name}" class="w-20 h-20 rounded-full mx-auto mb-3">
                        <h4 class="font-semibold">${photographer.name}</h4>
                        <p class="text-sm text-slate-600">${photographer.specialties ? photographer.specialties.join(', ') : 'Photographer'}</p>
                        <p class="text-sm text-slate-500 mt-2">${photographer.experience || 5}+ years experience</p>
                        <p class="text-sm font-semibold text-orange-600">$${photographer.hourlyRate || 150}/hour</p>
                    </div>
                `;
            } else {
                console.log('Profile info element not found');
            }
            
            // Get photographer's bookings
            const allBookings = JSON.parse(localStorage.getItem('lenslink_bookings') || '[]');
            const photographerBookings = allBookings.filter(booking => booking.photographerId === photographer.id);
            
            console.log('Found bookings:', photographerBookings.length);
            
            // Update stats
            const totalBookings = photographerBookings.length;
            const thisMonth = new Date().getMonth();
            const thisYear = new Date().getFullYear();
            const monthlyBookings = photographerBookings.filter(booking => {
                const bookingDate = new Date(booking.date);
                return bookingDate.getMonth() === thisMonth && bookingDate.getFullYear() === thisYear;
            }).length;
            
            // Update stats elements with error checking
            const totalBookingsEl = document.getElementById('total-bookings');
            const monthlyBookingsEl = document.getElementById('monthly-bookings');
            const portfolioCountEl = document.getElementById('portfolio-count');
            const averageRatingEl = document.getElementById('average-rating');
            
            if (totalBookingsEl) totalBookingsEl.textContent = totalBookings;
            if (monthlyBookingsEl) monthlyBookingsEl.textContent = monthlyBookings;
            if (portfolioCountEl) portfolioCountEl.textContent = photographer.portfolio ? photographer.portfolio.length : '0';
            if (averageRatingEl) averageRatingEl.textContent = '5.0';
            
            // Display portfolio images in dashboard
            displayPortfolioInDashboard(photographer);
            
            // Display dashboard bookings with client details
            const container = document.getElementById('dashboard-bookings');
            if (container) {
                if (photographerBookings.length === 0) {
                    container.innerHTML = '<p class="text-slate-600">No bookings yet. Clients will be able to contact you through your profile page.</p>';
                } else {
                    const bookingsHTML = photographerBookings.map(booking => {
                        const formatTime = (time) => {
                            const [hour, minute] = time.split(':');
                            const h = parseInt(hour);
                            if (h === 0) return `12:${minute} AM`;
                            if (h < 12) return `${h}:${minute} AM`;
                            if (h === 12) return `12:${minute} PM`;
                            return `${h - 12}:${minute} PM`;
                        };
                        
                        const formatDate = (dateStr) => {
                            const date = new Date(dateStr);
                            return date.toLocaleDateString('en-US', { 
                                month: 'short', 
                                day: 'numeric',
                                year: 'numeric'
                            });
                        };
                        
                        const statusColors = {
                            pending: 'bg-yellow-100 text-yellow-800',
                            confirmed: 'bg-green-100 text-green-800',
                            completed: 'bg-blue-100 text-blue-800',
                            cancelled: 'bg-red-100 text-red-800'
                        };
                        
                        return `
                            <div class="bg-white border rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow">
                                <div class="flex items-start justify-between">
                                    <div class="flex items-start space-x-4">
                                        <img src="${booking.clientProfileImage}" 
                                             alt="${booking.clientName}" 
                                             class="w-12 h-12 rounded-full object-cover">
                                        <div class="flex-1">
                                            <h4 class="font-semibold text-lg">${booking.clientName}</h4>
                                            <p class="text-sm text-slate-600">${booking.clientEmail}</p>
                                            ${booking.clientPhone ? `<p class="text-sm text-slate-600">📱 ${booking.clientPhone}</p>` : ''}
                                        </div>
                                    </div>
                                    <span class="px-2 py-1 rounded-full text-xs font-medium ${statusColors[booking.status] || statusColors.pending}">
                                        ${booking.status.charAt(0).toUpperCase() + booking.status.slice(1)}
                                    </span>
                                </div>
                                
                                <div class="mt-4 grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                                    <div>
                                        <span class="font-medium text-slate-700">Date:</span>
                                        <p class="text-slate-600">${formatDate(booking.date)}</p>
                                    </div>
                                    <div>
                                        <span class="font-medium text-slate-700">Time:</span>
                                        <p class="text-slate-600">${formatTime(booking.time)}</p>
                                    </div>
                                    <div>
                                        <span class="font-medium text-slate-700">Session:</span>
                                        <p class="text-slate-600">${booking.sessionType}</p>
                                    </div>
                                    <div>
                                        <span class="font-medium text-slate-700">Duration:</span>
                                        <p class="text-slate-600">${booking.duration} hours</p>
                                    </div>
                                </div>
                                
                                ${booking.requirements ? `
                                <div class="mt-3">
                                    <span class="font-medium text-slate-700">Special Requirements:</span>
                                    <p class="text-slate-600 mt-1">${booking.requirements}</p>
                                </div>
                                ` : ''}
                                
                                <div class="mt-4 flex justify-between items-center">
                                    <div class="text-lg font-bold text-orange-600">
                                        Total: $${booking.totalCost}
                                    </div>
                                    <div class="space-x-2">
                                        ${booking.status === 'pending' ? `
                                            <button onclick="updateBookingStatus('${booking.id}', 'confirmed')" 
                                                    class="px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700 transition-colors">
                                                Confirm
                                            </button>
                                            <button onclick="updateBookingStatus('${booking.id}', 'cancelled')" 
                                                    class="px-3 py-1 bg-red-600 text-white rounded text-sm hover:bg-red-700 transition-colors">
                                                Cancel
                                            </button>
                                        ` : booking.status === 'confirmed' ? `
                                            <button onclick="updateBookingStatus('${booking.id}', 'completed')" 
                                                    class="px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 transition-colors">
                                                Mark Complete
                                            </button>
                                        ` : ''}
                                    </div>
                                </div>
                                
                                <div class="mt-2 text-xs text-slate-500">
                                    Booking ID: ${booking.id} • Created: ${new Date(booking.createdAt).toLocaleDateString()}
                                </div>
                            </div>
                        `;
                    }).join('');
                    
                    container.innerHTML = bookingsHTML;
                }
            }
        }
        
        // Function to display portfolio images in dashboard
        function displayPortfolioInDashboard(photographer) {
            // Find a place to display portfolio or create one
            let portfolioContainer = document.getElementById('dashboard-portfolio-display');
            
            if (!portfolioContainer) {
                // Create portfolio display section in the profile summary
                const profileCard = document.querySelector('#photographer-dashboard-page .bg-white');
                if (profileCard) {
                    const portfolioSection = document.createElement('div');
                    portfolioSection.id = 'dashboard-portfolio-display';
                    portfolioSection.className = 'mt-6';
                    portfolioSection.innerHTML = `
                        <h4 class="text-lg font-semibold text-slate-700 mb-3">Portfolio Preview</h4>
                        <div id="portfolio-images-container" class="grid grid-cols-2 gap-2"></div>
                    `;
                    profileCard.appendChild(portfolioSection);
                    portfolioContainer = portfolioSection;
                }
            }
            
            const imagesContainer = document.getElementById('portfolio-images-container');
            if (!imagesContainer) return;
            
            if (!photographer.portfolio || photographer.portfolio.length === 0) {
                imagesContainer.innerHTML = '<p class="col-span-2 text-center text-slate-500 text-sm">No portfolio images yet</p>';
                return;
            }
            
            // Display first 4 portfolio images
            const imagesToShow = photographer.portfolio.slice(0, 4);
            imagesContainer.innerHTML = imagesToShow.map((portfolioItem, index) => {
                const imageData = portfolioItem.data || portfolioItem;
                return `
                    <div class="relative group cursor-pointer" onclick="viewPortfolioImage('${photographer.id}', ${index})">
                        <img src="${imageData}" 
                             alt="Portfolio ${index + 1}" 
                             class="w-full h-20 object-cover rounded-lg border-2 border-slate-200 hover:border-orange-400 transition-colors">
                        <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-opacity rounded-lg flex items-center justify-center">
                            <div class="opacity-0 group-hover:opacity-100 text-white text-xs">View</div>
                        </div>
                    </div>
                `;
            }).join('') + (photographer.portfolio.length > 4 ? `
                <div class="col-span-2 text-center">
                    <button onclick="viewFullPortfolio('${photographer.id}')" 
                            class="text-sm text-orange-600 hover:text-orange-800 font-medium">
                        View All ${photographer.portfolio.length} Images →
                    </button>
                </div>
            ` : '');
        }
        
        // Function to view portfolio image in modal
        window.viewPortfolioImage = function(photographerId, imageIndex) {
            const photographer = allPhotographers.find(p => p.id === photographerId) || currentUser;
            if (!photographer || !photographer.portfolio || !photographer.portfolio[imageIndex]) return;
            
            const imageData = photographer.portfolio[imageIndex].data || photographer.portfolio[imageIndex];
            const imageName = photographer.portfolio[imageIndex].name || `Portfolio Image ${imageIndex + 1}`;
            
            // Create modal to view image
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="relative max-w-4xl max-h-full">
                    <img src="${imageData}" alt="${imageName}" class="max-w-full max-h-full object-contain rounded-lg">
                    <button onclick="this.closest('.fixed').remove()" 
                            class="absolute top-4 right-4 bg-white text-black rounded-full w-8 h-8 flex items-center justify-center hover:bg-gray-200">
                        ×
                    </button>
                    <div class="absolute bottom-4 left-4 bg-black bg-opacity-60 text-white p-2 rounded">
                        ${imageName}
                    </div>
                </div>
            `;
            
            // Close modal when clicking outside
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
            
            document.body.appendChild(modal);
        };
        
        // Function to view full portfolio
        window.viewFullPortfolio = function(photographerId) {
            const photographer = allPhotographers.find(p => p.id === photographerId) || currentUser;
            if (!photographer || !photographer.portfolio) return;
            
            showPage('photographer-portfolio-view');
            setTimeout(() => {
                displayFullPortfolio(photographer);
            }, 100);
        };
        
        function displayFullPortfolio(photographer) {
            let portfolioPage = document.getElementById('photographer-portfolio-view');
            if (!portfolioPage) {
                // Create portfolio view page if it doesn't exist
                portfolioPage = document.createElement('div');
                portfolioPage.id = 'photographer-portfolio-view';
                portfolioPage.className = 'page container mx-auto px-6 py-16';
                portfolioPage.innerHTML = `
                    <div class="text-center mb-8">
                        <h1 class="text-4xl font-bold font-serif-display">${photographer.name}'s Portfolio</h1>
                        <p class="text-lg text-slate-600 mt-2">Professional photography portfolio</p>
                        <button onclick="showPage('photographer-dashboard-page')" 
                                class="mt-4 bg-orange-500 text-white px-6 py-2 rounded-md hover:bg-orange-600">
                            ← Back to Dashboard
                        </button>
                    </div>
                    <div id="full-portfolio-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Portfolio images will be inserted here -->
                    </div>
                `;
                document.body.appendChild(portfolioPage);
            }
            
            const container = document.getElementById('full-portfolio-container');
            if (!container) return;
            
            if (!photographer.portfolio || photographer.portfolio.length === 0) {
                container.innerHTML = '<div class="col-span-full text-center text-slate-500">No portfolio images available</div>';
                return;
            }
            
            container.innerHTML = photographer.portfolio.map((portfolioItem, index) => {
                const imageData = portfolioItem.data || portfolioItem;
                const imageName = portfolioItem.name || `Portfolio Image ${index + 1}`;
                return `
                    <div class="bg-white rounded-lg shadow-md overflow-hidden">
                        <img src="${imageData}" 
                             alt="${imageName}" 
                             class="w-full h-64 object-cover cursor-pointer hover:opacity-90 transition-opacity"
                             onclick="viewPortfolioImage('${photographer.id}', ${index})">
                        <div class="p-4">
                            <p class="text-sm text-slate-600 truncate">${imageName}</p>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Function to update booking status
        window.updateBookingStatus = function(bookingId, newStatus) {
            const allBookings = JSON.parse(localStorage.getItem('lenslink_bookings') || '[]');
            const bookingIndex = allBookings.findIndex(booking => booking.id === bookingId);
            
            if (bookingIndex !== -1) {
                allBookings[bookingIndex].status = newStatus;
                allBookings[bookingIndex].updatedAt = new Date().toISOString();
                localStorage.setItem('lenslink_bookings', JSON.stringify(allBookings));
                
                // Refresh the dashboard
                loadPhotographerDashboard();
                
                // Show confirmation message
                const statusMessages = {
                    confirmed: 'Booking confirmed! The client will be notified.',
                    cancelled: 'Booking cancelled. The client will be notified.',
                    completed: 'Booking marked as completed. Thank you!'
                };
                
                alert(statusMessages[newStatus] || 'Booking status updated.');
            }
        };

        // Load dashboard data based on user role
        function loadDashboard() {
            if (!currentUser) return;
            
            if (currentUser.role === 'photographer') {
                loadPhotographerDashboard();
            } else {
                loadClientDashboard();
            }
        }

        function loadClientDashboard() {
            // For regular users/clients - show their bookings
            const allBookings = JSON.parse(localStorage.getItem('lenslink_bookings') || '[]');
            const clientBookings = allBookings.filter(booking => booking.clientId === currentUser.id);
            
            document.getElementById('total-bookings').textContent = clientBookings.length;
            document.getElementById('average-rating').textContent = 'N/A';
            document.getElementById('portfolio-count').textContent = 'N/A';
            document.getElementById('monthly-bookings').textContent = clientBookings.filter(booking => {
                const bookingDate = new Date(booking.date);
                const thisMonth = new Date().getMonth();
                const thisYear = new Date().getFullYear();
                return bookingDate.getMonth() === thisMonth && bookingDate.getFullYear() === thisYear;
            }).length;
            
            const container = document.getElementById('dashboard-bookings');
            if (container) {
                if (clientBookings.length === 0) {
                    container.innerHTML = '<p class="text-slate-600">No bookings yet. Browse photographers to book your first session!</p>';
                } else {
                    const bookingsHTML = clientBookings.map(booking => {
                        const formatTime = (time) => {
                            const [hour, minute] = time.split(':');
                            const h = parseInt(hour);
                            if (h === 0) return `12:${minute} AM`;
                            if (h < 12) return `${h}:${minute} AM`;
                            if (h === 12) return `12:${minute} PM`;
                            return `${h - 12}:${minute} PM`;
                        };
                        
                        const formatDate = (dateStr) => {
                            const date = new Date(dateStr);
                            return date.toLocaleDateString('en-US', { 
                                weekday: 'long',
                                month: 'long', 
                                day: 'numeric',
                                year: 'numeric'
                            });
                        };
                        
                        const statusColors = {
                            pending: 'bg-yellow-100 text-yellow-800',
                            confirmed: 'bg-green-100 text-green-800',
                            completed: 'bg-blue-100 text-blue-800',
                            cancelled: 'bg-red-100 text-red-800'
                        };
                        
                        const photographer = allPhotographers.find(p => p.id === booking.photographerId);
                        
                        return `
                            <div class="bg-white border rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow">
                                <div class="flex items-start justify-between">
                                    <div class="flex items-start space-x-4">
                                        <img src="${photographer?.profileImage || 'https://placehold.co/100x100/94a3b8/ffffff?text=P'}" 
                                             alt="${booking.photographerName}" 
                                             class="w-12 h-12 rounded-full object-cover">
                                        <div class="flex-1">
                                            <h4 class="font-semibold text-lg">${booking.photographerName}</h4>
                                            <p class="text-sm text-slate-600">${photographer?.specialties?.join(', ') || 'Professional Photographer'}</p>
                                            <p class="text-sm text-slate-600">📧 ${booking.photographerEmail}</p>
                                        </div>
                                    </div>
                                    <span class="px-2 py-1 rounded-full text-xs font-medium ${statusColors[booking.status] || statusColors.pending}">
                                        ${booking.status.charAt(0).toUpperCase() + booking.status.slice(1)}
                                    </span>
                                </div>
                                
                                <div class="mt-4 grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                                    <div>
                                        <span class="font-medium text-slate-700">Date:</span>
                                        <p class="text-slate-600">${formatDate(booking.date)}</p>
                                    </div>
                                    <div>
                                        <span class="font-medium text-slate-700">Time:</span>
                                        <p class="text-slate-600">${formatTime(booking.time)}</p>
                                    </div>
                                    <div>
                                        <span class="font-medium text-slate-700">Session:</span>
                                        <p class="text-slate-600">${booking.sessionType}</p>
                                    </div>
                                    <div>
                                        <span class="font-medium text-slate-700">Duration:</span>
                                        <p class="text-slate-600">${booking.duration} hours</p>
                                    </div>
                                </div>
                                
                                ${booking.requirements ? `
                                <div class="mt-3">
                                    <span class="font-medium text-slate-700">Special Requirements:</span>
                                    <p class="text-slate-600 mt-1">${booking.requirements}</p>
                                </div>
                                ` : ''}
                                
                                <div class="mt-4 flex justify-between items-center">
                                    <div class="text-lg font-bold text-orange-600">
                                        Total: $${booking.totalCost}
                                    </div>
                                    <div class="text-sm text-slate-500">
                                        Status: ${booking.status === 'pending' ? 'Awaiting confirmation' : 
                                                 booking.status === 'confirmed' ? 'Confirmed! Photographer will contact you' :
                                                 booking.status === 'completed' ? 'Session completed' :
                                                 'Cancelled'}
                                    </div>
                                </div>
                                
                                <div class="mt-2 text-xs text-slate-500">
                                    Booking ID: ${booking.id} • Booked: ${new Date(booking.createdAt).toLocaleDateString()}
                                </div>
                            </div>
                        `;
                    }).join('');
                    
                    container.innerHTML = bookingsHTML;
                }
            }
        }

        function getStatusColor(status) {
            switch (status) {
                case 'confirmed': return 'bg-green-100 text-green-800';
                case 'pending': return 'bg-yellow-100 text-yellow-800';
                case 'completed': return 'bg-blue-100 text-blue-800';
                case 'cancelled': return 'bg-red-100 text-red-800';
                default: return 'bg-slate-100 text-slate-800';
            }
        }

        // --- Profile Photo Utility Functions ---
        function convertFileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        // Compress and resize image for faster loading
        function compressImage(file, maxWidth = 400, maxHeight = 400, quality = 0.8) {
            return new Promise((resolve) => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const img = new Image();
                
                img.onload = function() {
                    // Calculate new dimensions
                    let { width, height } = img;
                    
                    if (width > height) {
                        if (width > maxWidth) {
                            height = (height * maxWidth) / width;
                            width = maxWidth;
                        }
                    } else {
                        if (height > maxHeight) {
                            width = (width * maxHeight) / height;
                            height = maxHeight;
                        }
                    }
                    
                    // Set canvas dimensions
                    canvas.width = width;
                    canvas.height = height;
                    
                    // Draw and compress image
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // Convert to base64 with compression
                    const compressedDataUrl = canvas.toDataURL('image/jpeg', quality);
                    resolve(compressedDataUrl);
                };
                
                img.src = URL.createObjectURL(file);
            });
        }

        // Validate image file
        function validateImageFile(file) {
            const maxSize = 10 * 1024 * 1024; // 10MB limit
            const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
            
            if (!allowedTypes.includes(file.type)) {
                return { valid: false, error: 'Please select a valid image file (JPEG, PNG, GIF, or WebP)' };
            }
            
            if (file.size > maxSize) {
                return { valid: false, error: 'Image file size must be less than 10MB' };
            }
            
            return { valid: true };
        }

        // Preview image before upload
        function previewProfileImage(input) {
            const file = input.files[0];
            const previewContainer = document.getElementById('profile-image-preview');
            
            if (!file) {
                if (previewContainer) previewContainer.innerHTML = '';
                return;
            }
            
            // Validate file
            const validation = validateImageFile(file);
            if (!validation.valid) {
                alert(validation.error);
                input.value = '';
                if (previewContainer) previewContainer.innerHTML = '';
                return;
            }
            
            // Show loading indicator
            if (previewContainer) {
                previewContainer.innerHTML = `
                    <div class="text-center py-4">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500 mx-auto"></div>
                        <p class="text-sm text-slate-600 mt-2">Processing image...</p>
                    </div>
                `;
            }
            
            // Compress and preview image with error handling
            compressImage(file).then(compressedDataUrl => {
                if (previewContainer) {
                    const originalSize = (file.size / 1024).toFixed(1);
                    const compressedSize = (compressedDataUrl.length * 0.75 / 1024).toFixed(1); // Approximate size
                    
                    previewContainer.innerHTML = `
                        <div class="text-center">
                            <img src="${compressedDataUrl}" 
                                 alt="Profile preview" 
                                 class="w-32 h-32 rounded-full mx-auto object-cover border-4 border-orange-200 shadow-lg">
                            <p class="text-sm text-green-600 mt-2">
                                ✅ Image optimized: ${originalSize}KB → ${compressedSize}KB
                            </p>
                            <p class="text-xs text-slate-500">
                                Image will load quickly for your clients!
                            </p>
                        </div>
                    `;
                }
                
                // Store compressed image for later use
                input.compressedImage = compressedDataUrl;
            }).catch(error => {
                console.error('Image processing failed:', error);
                if (previewContainer) {
                    previewContainer.innerHTML = `
                        <div class="text-center py-4">
                            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                                <p class="text-sm text-yellow-700">
                                    ⚠️ Image processing failed. Don't worry - you can still register!
                                </p>
                                <p class="text-xs text-yellow-600 mt-1">
                                    A default profile image will be used.
                                </p>
                            </div>
                        </div>
                    `;
                }
                // Clear the compressed image so registration uses default
                input.compressedImage = null;
            });
        }

        // Portfolio images preview and management
        let portfolioImages = [];
        
        function previewPortfolioImages(input) {
            const files = Array.from(input.files);
            const previewContainer = document.getElementById('portfolio-images-preview');
            const generateBtn = document.getElementById('generate-portfolio-pdf');
            
            if (!files.length) {
                if (previewContainer) previewContainer.innerHTML = '';
                if (generateBtn) generateBtn.disabled = true;
                portfolioImages = [];
                return;
            }
            
            // Limit to 10 images
            if (files.length > 10) {
                alert('Please select maximum 10 images for your portfolio');
                input.value = '';
                return;
            }
            
            // Validate all files
            for (let file of files) {
                const validation = validateImageFile(file);
                if (!validation.valid) {
                    alert(`Error with "${file.name}": ${validation.error}`);
                    input.value = '';
                    if (previewContainer) previewContainer.innerHTML = '';
                    return;
                }
            }
            
            // Show loading indicator
            if (previewContainer) {
                previewContainer.innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-orange-500 mx-auto"></div>
                        <p class="text-sm text-slate-600 mt-2">Processing ${files.length} portfolio images...</p>
                        <p class="text-xs text-slate-500">This may take a moment</p>
                    </div>
                `;
            }
            
            // Process all images
            portfolioImages = [];
            let processedCount = 0;
            
            files.forEach((file, index) => {
                compressImage(file).then(compressedDataUrl => {
                    portfolioImages.push({
                        name: file.name,
                        originalSize: file.size,
                        compressedData: compressedDataUrl,
                        index: index
                    });
                    
                    processedCount++;
                    
                    // Update preview once all images are processed
                    if (processedCount === files.length) {
                        updatePortfolioPreview();
                        if (generateBtn) generateBtn.disabled = false;
                    }
                }).catch(error => {
                    console.error(`Failed to process ${file.name}:`, error);
                    processedCount++;
                    
                    if (processedCount === files.length) {
                        updatePortfolioPreview();
                        if (generateBtn) generateBtn.disabled = portfolioImages.length === 0;
                    }
                });
            });
        }
        
        function updatePortfolioPreview() {
            const previewContainer = document.getElementById('portfolio-images-preview');
            if (!previewContainer) return;
            
            if (portfolioImages.length === 0) {
                previewContainer.innerHTML = '<p class="col-span-full text-center text-slate-500">No images processed</p>';
                return;
            }
            
            const totalOriginalSize = portfolioImages.reduce((sum, img) => sum + img.originalSize, 0);
            const totalCompressedSize = portfolioImages.reduce((sum, img) => sum + (img.compressedData.length * 0.75), 0);
            
            previewContainer.innerHTML = `
                <div class="col-span-full mb-4 p-3 bg-green-50 border border-green-200 rounded-lg">
                    <p class="text-sm text-green-700 font-medium">
                        ✅ ${portfolioImages.length} images processed successfully
                    </p>
                    <p class="text-xs text-green-600">
                        Total size optimized: ${(totalOriginalSize/1024/1024).toFixed(1)}MB → ${(totalCompressedSize/1024/1024).toFixed(1)}MB
                    </p>
                </div>
                ${portfolioImages.map((img, index) => `
                    <div class="relative group">
                        <img src="${img.compressedData}" 
                             alt="Portfolio ${index + 1}" 
                             class="w-full h-24 object-cover rounded-lg border-2 border-slate-200 hover:border-orange-300 transition-colors">
                        <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 transition-opacity rounded-lg flex items-center justify-center">
                            <button onclick="removePortfolioImage(${index})" 
                                    class="opacity-0 group-hover:opacity-100 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs hover:bg-red-600 transition-all">
                                ×
                            </button>
                        </div>
                        <p class="text-xs text-slate-500 mt-1 truncate">${img.name}</p>
                    </div>
                `).join('')}
            `;
        }
        
        function removePortfolioImage(index) {
            portfolioImages.splice(index, 1);
            updatePortfolioPreview();
            
            const generateBtn = document.getElementById('generate-portfolio-pdf');
            if (generateBtn) generateBtn.disabled = portfolioImages.length === 0;
        }
        
        function generatePortfolioPDF() {
            if (portfolioImages.length === 0) {
                alert('Please upload some portfolio images first');
                return;
            }
            
            // Create PDF using simple HTML/print approach
            const photographerName = document.getElementById('register-name')?.value || 'Photographer';
            
            // Create a new window with the portfolio
            const portfolioWindow = window.open('', '_blank', 'width=800,height=600');
            
            const portfolioHTML = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>${photographerName} - Portfolio</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; background: white; }
                        h1 { color: #1e293b; text-align: center; margin-bottom: 30px; }
                        .portfolio-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
                        .portfolio-item { text-align: center; page-break-inside: avoid; margin-bottom: 20px; }
                        img { max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
                        .print-btn { position: fixed; top: 20px; right: 20px; background: #f97316; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; z-index: 1000; }
                        .print-btn:hover { background: #ea580c; }
                        .footer { text-align: center; margin-top: 40px; color: #64748b; border-top: 1px solid #e2e8f0; padding-top: 20px; }
                        @media print { 
                            .print-btn { display: none; } 
                            body { margin: 0; }
                            .portfolio-grid { grid-template-columns: repeat(2, 1fr); }
                        }
                    </style>
                </head>
                <body>
                    <button class="print-btn" onclick="window.print()">📄 Print/Save as PDF</button>
                    <h1>${photographerName} - Photography Portfolio</h1>
                    <div class="portfolio-grid">
                        ${portfolioImages.map((img, index) => `
                            <div class="portfolio-item">
                                <img src="${img.compressedData}" alt="Portfolio Image ${index + 1}">
                                <p style="margin-top: 10px; font-size: 14px; color: #374151;">Portfolio Image ${index + 1}</p>
                            </div>
                        `).join('')}
                    </div>
                    <div class="footer">
                        <p><strong>Generated with LensLink Photography Platform</strong></p>
                        <p>Contact: ${document.getElementById('register-email')?.value || ''}</p>
                        <p>Phone: ${document.getElementById('register-phone')?.value || ''}</p>
                        <p>Location: ${document.getElementById('register-location')?.value || ''}</p>
                    </div>
                </body>
            `;
            
            portfolioWindow.document.write(portfolioHTML);
            portfolioWindow.document.close();
            
            // Auto-focus and show instructions after a short delay
            setTimeout(() => {
                portfolioWindow.focus();
                alert('✅ Portfolio opened in new window!\\n\\n📄 Click "Print/Save as PDF" button to save or print your portfolio.\\n\\n💡 Tip: Choose "Save as PDF" in the print dialog to create a downloadable portfolio file for clients.');
            }, 500);
        }

        // Make generatePortfolioPDF globally accessible
        window.generatePortfolioPDF = generatePortfolioPDF;

        // Portfolio viewer functions for clients
        function viewPhotographerPortfolioPDF(photographerId) {
            const photographer = allPhotographers.find(p => p.id === photographerId);
            if (!photographer || !photographer.portfolio || photographer.portfolio.length === 0) {
                alert('This photographer has not uploaded a portfolio yet.');
                return;
            }
            
            // Create portfolio PDF window for existing photographer
            const portfolioWindow = window.open('', '_blank', 'width=800,height=600');
            
            const portfolioHTML = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>${photographer.name} - Portfolio</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; background: white; }
                        h1 { color: #1e293b; text-align: center; margin-bottom: 30px; }
                        .photographer-info { text-align: center; margin-bottom: 40px; padding: 20px; background: #f8fafc; border-radius: 8px; }
                        .portfolio-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
                        .portfolio-item { text-align: center; page-break-inside: avoid; margin-bottom: 20px; }
                        img { max-width: 100%; height: auto; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
                        .print-btn { position: fixed; top: 20px; right: 20px; background: #f97316; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; z-index: 1000; }
                        .print-btn:hover { background: #ea580c; }
                        .footer { text-align: center; margin-top: 40px; color: #64748b; border-top: 1px solid #e2e8f0; padding-top: 20px; }
                        @media print { 
                            .print-btn { display: none; } 
                            body { margin: 0; }
                            .portfolio-grid { grid-template-columns: repeat(2, 1fr); }
                        }
                    </style>
                </head>
                <body>
                    <button class="print-btn" onclick="window.print()">📄 Print/Save as PDF</button>
                    <h1>${photographer.name} - Photography Portfolio</h1>
                    <div class="photographer-info">
                        <p><strong>Specialties:</strong> ${photographer.specialties ? photographer.specialties.join(', ') : 'Professional Photography'}</p>
                        <p><strong>Experience:</strong> ${photographer.experience || 5}+ years</p>
                        <p><strong>Rate:</strong> $${photographer.hourlyRate || 150}/hour</p>
                        <p><strong>Location:</strong> ${photographer.location || 'Available for travel'}</p>
                    </div>
                    <div class="portfolio-grid">
                        ${photographer.portfolio.map((item, index) => `
                            <div class="portfolio-item">
                                <img src="${item.data || item}" alt="Portfolio Image ${index + 1}">
                                <p style="margin-top: 10px; font-size: 14px; color: #374151;">Portfolio Image ${index + 1}</p>
                            </div>
                        `).join('')}
                    </div>
                    <div class="footer">
                        <p><strong>Contact ${photographer.name}</strong></p>
                        <p>Email: ${photographer.email || ''}</p>
                        <p>Phone: ${photographer.phone || ''}</p>
                        <p><em>Generated with LensLink Photography Platform</em></p>
                    </div>
                </body>
                </html>
            `;
            
            portfolioWindow.document.write(portfolioHTML);
            portfolioWindow.document.close();
            
            setTimeout(() => {
                portfolioWindow.focus();
            }, 500);
        }
        
        function openPortfolioModal(photographerId, imageIndex) {
            const photographer = allPhotographers.find(p => p.id === photographerId);
            if (!photographer || !photographer.portfolio || !photographer.portfolio[imageIndex]) return;
            
            // Create a simple modal overlay
            const modalHTML = `
                <div id="portfolio-modal" class="fixed inset-0 z-50 bg-black bg-opacity-75 flex items-center justify-center p-4" onclick="closePortfolioModal()">
                    <div class="relative max-w-4xl max-h-full" onclick="event.stopPropagation()">
                        <button onclick="closePortfolioModal()" class="absolute -top-10 right-0 text-white text-xl hover:text-gray-300">✕ Close</button>
                        <img src="${photographer.portfolio[imageIndex].data || photographer.portfolio[imageIndex]}" 
                             alt="Portfolio image ${imageIndex + 1}" 
                             class="max-w-full max-h-full object-contain rounded-lg">
                        <div class="absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white p-4 rounded-b-lg">
                            <p class="text-center">Portfolio Image ${imageIndex + 1} of ${photographer.portfolio.length}</p>
                        </div>
                    </div>
                </div>
            `;
            
            // Remove existing modal if any
            const existingModal = document.getElementById('portfolio-modal');
            if (existingModal) existingModal.remove();
            
            // Add modal to body
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }
        
        // Make globally accessible
        window.closePortfolioModal = function() {
            const modal = document.getElementById('portfolio-modal');
            if (modal) modal.remove();
        }
    </script>
</body>
</html>